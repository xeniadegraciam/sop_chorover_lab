<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>XAFS Analysis Pipeline:</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="2207_Sulfur_XANES_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="2207_Sulfur_XANES_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="2207_Sulfur_XANES_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="2207_Sulfur_XANES_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2207_Sulfur_XANES_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="2207_Sulfur_XANES_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2207_Sulfur_XANES_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2207_Sulfur_XANES_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2207_Sulfur_XANES_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2207_Sulfur_XANES_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">XAFS Analysis Pipeline:</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>üìÇ Loads and groups the cleaned CSV files by sample name,</p>
<p>‚ûó Averages replicates,</p>
<p>‚ú® Normalizes XANES (with E‚ÇÄ detection),</p>
<p>üî¨ Extracts EXAFS (chi(k) and FT) data,</p>
<p>üñºÔ∏è Plots everything for clear visualization.</p>
<div id="dd798437" class="cell" data-execution_count="213">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> patches</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> LinearSegmentedColormap</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Larch modules for XAFS analysis</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> larch.xafs <span class="im">import</span> pre_edge, autobk, feffpath, xftf</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> larch <span class="im">import</span> Group</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># === 1Ô∏è‚É£ FOLDER PATH ===</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>folder_path <span class="op">=</span> <span class="st">'D:/Research/FieldNotes/Synchrotron/2207_SSRL_BL4-3_XAS_Sulfur'</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Folder path for sulfur references</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>sulfur_ref_path <span class="op">=</span> <span class="st">'D:/Research/FieldNotes/Synchrotron/Rob_Standards/Sulfur'</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the save path</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>save_folder <span class="op">=</span> <span class="vs">r"C:/Users/xeniadegracia/OneDrive - University of Arizona/Research/FieldNotes/Synchrotron/2207_SSRL_BL4-3_XAS_Sulfur/LARCH"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="eabb18fb" class="cell" data-execution_count="214">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 2Ô∏è‚É£ FIND ALL CLEANED FILES ===</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>csv_files <span class="op">=</span> glob(os.path.join(folder_path, <span class="st">'*_clean.csv'</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"‚úÖ Found </span><span class="sc">{</span><span class="bu">len</span>(csv_files)<span class="sc">}</span><span class="ss"> cleaned samples CSV files."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Found 181 cleaned samples CSV files.</code></pre>
</div>
</div>
<div id="037bc22d" class="cell" data-execution_count="215">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 2Ô∏è‚É£ FIND ALL CLEANED FILES OF REFERENCES OF SULFUR===</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sulfur_references_files <span class="op">=</span> glob(os.path.join(sulfur_ref_path, <span class="st">'*_clean.csv'</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"‚úÖ Found </span><span class="sc">{</span><span class="bu">len</span>(sulfur_references_files)<span class="sc">}</span><span class="ss"> cleaned samples CSV files."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Found 12 cleaned samples CSV files.</code></pre>
</div>
</div>
<div id="6335d660" class="cell" data-execution_count="216">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 3Ô∏è‚É£ GROUP FILES BY SAMPLE NAME (ignoring replicate number) ===</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sample_groups <span class="op">=</span> {}</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> csv_files:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    base <span class="op">=</span> os.path.basename(<span class="bu">file</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assumes filename pattern: SampleName_Replicate_clean.csv</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    sample_name <span class="op">=</span> <span class="st">'_'</span>.join(base.split(<span class="st">'_'</span>)[:<span class="op">-</span><span class="dv">2</span>])  <span class="co"># Get everything before _Rep#_clean</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    sample_groups.setdefault(sample_name, []).append(<span class="bu">file</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>bad_samples <span class="op">=</span> [<span class="st">"TB2"</span>, <span class="st">"MG_4"</span>, <span class="st">"MM_bad"</span>]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>sample_groups <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> sample_groups.items() <span class="cf">if</span> <span class="kw">not</span> <span class="bu">any</span>(bad <span class="kw">in</span> k <span class="cf">for</span> bad <span class="kw">in</span> bad_samples)}</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"‚úÖ Grouped into </span><span class="sc">{</span><span class="bu">len</span>(sample_groups)<span class="sc">}</span><span class="ss"> sample(s): </span><span class="sc">{</span><span class="bu">list</span>(sample_groups.keys())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Grouped into 130 sample(s): ['S_BC_B_69_017', 'S_BC_D_116_103', 'S_BC_E_117_104', 'S_BC_G_118_105', 'S_BC_H_119_106', 'S_BC_J_120_107', 'S_BC_K_121_108', 'S_BC_L_122_109', 'S_BC_M_123_110', 'S_BC_O_124_111', 'S_BC_test_core_078', 'S_BK_A_63_009', 'S_BK_B_73_038', 'S_BK_C_47_004', 'S_BK_D_162_177', 'S_BK_E_163_178', 'S_BK_F_164_179', 'S_BK_G_48_005', 'S_BK_H_165_180', 'S_BK_I_166_181', 'S_BK_J_49_007', 'S_BK_K_167_182', 'S_BK_L_168_183', 'S_BK_M_169_184', 'S_BK_N_50_008', 'S_CC_B_71_019', 'S_CC_D_134_121', 'S_CC_E_135_122', 'S_CC_G_136_123', 'S_CC_H_137_124', 'S_CC_J_138_125', 'S_CC_L_139_126', 'S_CT_B_68_016', 'S_CT_core_A_077', 'S_CT_core_B_082', 'S_CT_core_B_C_079', 'S_CT_core_B_C_082', 'S_CT_D_110_094', 'S_CT_D_110_097', 'S_CT_E_111_098', 'S_CT_G_112_099', 'S_CT_H_113_100', 'S_CT_J_114_101', 'S_CT_K_115_102', 'S_GP_AA_160_089', 'S_GP_AC_161_090', 'S_GP_B_72_020', 'S_GP_B_72_023', 'S_GP_core3_2_075', 'S_GP_D_140_127', 'S_GP_E_141_128', 'S_GP_F_142_129', 'S_GP_G_143_130', 'S_GP_H_144_131', 'S_GP_I_145_132', 'S_GP_K_146_133', 'S_GP_L_147_149', 'S_GP_M_148_150', 'S_GP_N_149_151', 'S_GP_P_150_152', 'S_GP_Q_151_153', 'S_GP_R_152_154', 'S_GP_S_153_155', 'S_GP_U_154_156', 'S_GP_V_155_084', 'S_GP_W_156_085', 'S_GP_X_157_086', 'S_GP_Y_158_087', 'S_GP_Z_159_088', 'S_KT_B_70_018', 'S_KT_core2_083', 'S_KT_D_125_112', 'S_KT_E_126_113', 'S_KT_G_127_114', 'S_KT_H_128_115', 'S_KT_I_129_116', 'S_KT_K_130_117', 'S_KT_L_131_118', 'S_KT_M_132_119', 'S_KT_N_133_120', 'S_KT_O_R1_L5_063', 'S_KT_O_R2_L6_064', 'S_MG_B_66_014', 'S_MG_B_66_021', 'S_MG_core1_2_076', 'S_MG_C_19_002', 'S_MG_D_86_041', 'S_MG_E_87_042', 'S_MG_F_88_043', 'S_MG_G_89_044', 'S_MG_H_20_003', 'S_MG_I_90_045', 'S_MG_J_91_046', 'S_MG_K_92_047', 'S_MG_L_93_048', 'S_MG_M_94_049', 'S_MG_O_95_050', 'S_MG_P_96_051', 'S_MM_B_67_015', 'S_MM_B_67_022', 'S_MM_core1_080', 'S_MM_D_97_052', 'S_MM_E_98_053', 'S_MM_F_99_054', 'S_MM_G_100_055', 'S_MM_H_101_056', 'S_MM_I_102_057', 'S_MM_L_103_058', 'S_MM_M_104_059', 'S_MM_N_105_060', 'S_MM_O_106_061', 'S_MM_P_107_091', 'S_MM_Q_108_092', 'S_MM_R_109_093', 'S_MM_S_R1_L1_065', 'S_MM_S_R2_L2_066', 'S_Pyrite_FeS2_141', 'S_TB_B_65_013', 'S_TB_core1_081', 'S_TB_D_170_185', 'S_TB_E_171_186', 'S_TB_F_172_187', 'S_TB_G_173_188', 'S_TB_H_174_189', 'S_TB_J_175_190', 'S_TB_L_176_191', 'S_TB_M_177_192', 'S_TB_N_85_040', 'S_TB_O_R1_L3_067', 'S_TB_O_R2_L4_068']</code></pre>
</div>
</div>
<div id="d58b491e" class="cell" data-execution_count="217">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 3Ô∏è‚É£ GROUP FILES BY REFERENCES NAME (ignoring replicate number) ===</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>reference_groups <span class="op">=</span> {}</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> sulfur_references_files:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    base <span class="op">=</span> os.path.basename(<span class="bu">file</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assumes filename pattern: SampleName_Replicate_clean.csv</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    reference_name <span class="op">=</span> <span class="st">'_'</span>.join(base.split(<span class="st">'_'</span>)[:<span class="op">-</span><span class="dv">2</span>])  <span class="co"># Get everything before _Rep#_clean</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    reference_groups.setdefault(reference_name, []).append(<span class="bu">file</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>bad_samples <span class="op">=</span> [<span class="st">"TB2"</span>, <span class="st">"MG_4"</span>, <span class="st">"MM_bad"</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>reference_groups <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> reference_groups.items() <span class="cf">if</span> <span class="kw">not</span> <span class="bu">any</span>(bad <span class="kw">in</span> k <span class="cf">for</span> bad <span class="kw">in</span> bad_samples)}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"‚úÖ Grouped into </span><span class="sc">{</span><span class="bu">len</span>(reference_groups)<span class="sc">}</span><span class="ss"> reference(s): </span><span class="sc">{</span><span class="bu">list</span>(reference_groups.keys())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Grouped into 5 reference(s): ['S_BY_Jarosite_067', 'S_Pyrite_FeS2_141', 'S_Schw_1_048', 'S_Schw_2_049', 'S_Schw_3_050']</code></pre>
</div>
</div>
<div id="35ed1269" class="cell" data-execution_count="218">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># üîç OPTIONAL STEP: Inspect individual replicate spectra before averaging</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sample, files <span class="kw">in</span> sample_groups.items():</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        plt.plot(df[<span class="st">'energy'</span>], df[<span class="st">'mu'</span>], label<span class="op">=</span>os.path.basename(f))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Absorbance vs Energy for </span><span class="sc">{</span>sample<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Energy (eV)"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Œº (Absorbance)"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    plt.legend(fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    plt.close()  <span class="co"># üëà prevents the plot from being retained by the notebook</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-11.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-12.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-13.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-14.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-15.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-16.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-17.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-18.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-19.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-20.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-21.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-22.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-23.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-24.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-25.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-26.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-27.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-28.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-29.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-30.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-31.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-32.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-33.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-34.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-35.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-36.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-37.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-38.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-39.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-40.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-41.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-42.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-43.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-44.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-45.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-46.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-47.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-48.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-49.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-50.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-51.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-52.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-53.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-54.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-55.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-56.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-57.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-58.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-59.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-60.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-61.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-62.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-63.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-64.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-65.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-66.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-67.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-68.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-69.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-70.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-71.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-72.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-73.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-74.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-75.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-76.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-77.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-78.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-79.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-80.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-81.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-82.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-83.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-84.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-85.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-86.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-87.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-88.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-89.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-90.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-91.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-92.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-93.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-94.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-95.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-96.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-97.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-98.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-99.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-100.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-101.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-102.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-103.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-104.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-105.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-106.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-107.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-108.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-109.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-110.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-111.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-112.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-113.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-114.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-115.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-116.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-117.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-118.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-119.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-120.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-121.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-122.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-123.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-124.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-125.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-126.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-127.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-128.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-129.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-7-output-130.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="b1a5f22f" class="cell" data-execution_count="219">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># üîç Inspect individual REFERENCES before averaging</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> reference, files <span class="kw">in</span> reference_groups.items():</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        plt.plot(df[<span class="st">'energy'</span>], df[<span class="st">'mu'</span>], label<span class="op">=</span>os.path.basename(f))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Absorbance vs Energy for </span><span class="sc">{</span>reference<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Energy (eV)"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Œº (Absorbance)"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    plt.legend(fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-8-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-8-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-8-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="301efd7b" class="cell" data-execution_count="220">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 4Ô∏è‚É£ AVERAGE REPLICATE SPECTRA ===</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>averaged_data <span class="op">=</span> {}</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sample, files <span class="kw">in</span> sample_groups.items():</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        dfs.append(df)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge on 'energy'</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> dfs[<span class="dv">0</span>][[<span class="st">'energy'</span>]].copy()</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    mu_cols <span class="op">=</span> []</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, df <span class="kw">in</span> <span class="bu">enumerate</span>(dfs):</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        colname <span class="op">=</span> <span class="ss">f'mu_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        merged[colname] <span class="op">=</span> df[<span class="st">'mu'</span>]</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        mu_cols.append(colname)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Average mu</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    merged[<span class="st">'mu_avg'</span>] <span class="op">=</span> merged[mu_cols].mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    averaged_data[sample] <span class="op">=</span> merged</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Averaged </span><span class="sc">{</span><span class="bu">len</span>(files)<span class="sc">}</span><span class="ss"> replicates for </span><span class="sc">{</span>sample<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>averaged_references <span class="op">=</span> {}</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> reference, files <span class="kw">in</span> reference_groups.items():</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        dfs.append(df)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge on 'energy'</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> dfs[<span class="dv">0</span>][[<span class="st">'energy'</span>]].copy()</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    mu_cols <span class="op">=</span> []</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, df <span class="kw">in</span> <span class="bu">enumerate</span>(dfs):</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>        colname <span class="op">=</span> <span class="ss">f'mu_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        merged[colname] <span class="op">=</span> df[<span class="st">'mu'</span>]</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        mu_cols.append(colname)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Average mu</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    merged[<span class="st">'mu_avg'</span>] <span class="op">=</span> merged[mu_cols].mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    averaged_references[reference] <span class="op">=</span> merged</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Averaged </span><span class="sc">{</span><span class="bu">len</span>(files)<span class="sc">}</span><span class="ss"> replicates for </span><span class="sc">{</span>reference<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Averaged 2 replicates for S_BC_B_69_017
‚úÖ Averaged 1 replicates for S_BC_D_116_103
‚úÖ Averaged 1 replicates for S_BC_E_117_104
‚úÖ Averaged 1 replicates for S_BC_G_118_105
‚úÖ Averaged 1 replicates for S_BC_H_119_106
‚úÖ Averaged 1 replicates for S_BC_J_120_107
‚úÖ Averaged 1 replicates for S_BC_K_121_108
‚úÖ Averaged 1 replicates for S_BC_L_122_109
‚úÖ Averaged 1 replicates for S_BC_M_123_110
‚úÖ Averaged 1 replicates for S_BC_O_124_111
‚úÖ Averaged 2 replicates for S_BC_test_core_078
‚úÖ Averaged 2 replicates for S_BK_A_63_009
‚úÖ Averaged 2 replicates for S_BK_B_73_038
‚úÖ Averaged 2 replicates for S_BK_C_47_004
‚úÖ Averaged 1 replicates for S_BK_D_162_177
‚úÖ Averaged 1 replicates for S_BK_E_163_178
‚úÖ Averaged 1 replicates for S_BK_F_164_179
‚úÖ Averaged 2 replicates for S_BK_G_48_005
‚úÖ Averaged 1 replicates for S_BK_H_165_180
‚úÖ Averaged 1 replicates for S_BK_I_166_181
‚úÖ Averaged 2 replicates for S_BK_J_49_007
‚úÖ Averaged 1 replicates for S_BK_K_167_182
‚úÖ Averaged 1 replicates for S_BK_L_168_183
‚úÖ Averaged 1 replicates for S_BK_M_169_184
‚úÖ Averaged 2 replicates for S_BK_N_50_008
‚úÖ Averaged 2 replicates for S_CC_B_71_019
‚úÖ Averaged 1 replicates for S_CC_D_134_121
‚úÖ Averaged 1 replicates for S_CC_E_135_122
‚úÖ Averaged 1 replicates for S_CC_G_136_123
‚úÖ Averaged 1 replicates for S_CC_H_137_124
‚úÖ Averaged 1 replicates for S_CC_J_138_125
‚úÖ Averaged 1 replicates for S_CC_L_139_126
‚úÖ Averaged 3 replicates for S_CT_B_68_016
‚úÖ Averaged 2 replicates for S_CT_core_A_077
‚úÖ Averaged 1 replicates for S_CT_core_B_082
‚úÖ Averaged 2 replicates for S_CT_core_B_C_079
‚úÖ Averaged 1 replicates for S_CT_core_B_C_082
‚úÖ Averaged 1 replicates for S_CT_D_110_094
‚úÖ Averaged 1 replicates for S_CT_D_110_097
‚úÖ Averaged 1 replicates for S_CT_E_111_098
‚úÖ Averaged 1 replicates for S_CT_G_112_099
‚úÖ Averaged 1 replicates for S_CT_H_113_100
‚úÖ Averaged 1 replicates for S_CT_J_114_101
‚úÖ Averaged 1 replicates for S_CT_K_115_102
‚úÖ Averaged 1 replicates for S_GP_AA_160_089
‚úÖ Averaged 1 replicates for S_GP_AC_161_090
‚úÖ Averaged 2 replicates for S_GP_B_72_020
‚úÖ Averaged 1 replicates for S_GP_B_72_023
‚úÖ Averaged 2 replicates for S_GP_core3_2_075
‚úÖ Averaged 1 replicates for S_GP_D_140_127
‚úÖ Averaged 1 replicates for S_GP_E_141_128
‚úÖ Averaged 1 replicates for S_GP_F_142_129
‚úÖ Averaged 1 replicates for S_GP_G_143_130
‚úÖ Averaged 1 replicates for S_GP_H_144_131
‚úÖ Averaged 1 replicates for S_GP_I_145_132
‚úÖ Averaged 1 replicates for S_GP_K_146_133
‚úÖ Averaged 1 replicates for S_GP_L_147_149
‚úÖ Averaged 2 replicates for S_GP_M_148_150
‚úÖ Averaged 2 replicates for S_GP_N_149_151
‚úÖ Averaged 2 replicates for S_GP_P_150_152
‚úÖ Averaged 1 replicates for S_GP_Q_151_153
‚úÖ Averaged 2 replicates for S_GP_R_152_154
‚úÖ Averaged 2 replicates for S_GP_S_153_155
‚úÖ Averaged 1 replicates for S_GP_U_154_156
‚úÖ Averaged 1 replicates for S_GP_V_155_084
‚úÖ Averaged 1 replicates for S_GP_W_156_085
‚úÖ Averaged 1 replicates for S_GP_X_157_086
‚úÖ Averaged 1 replicates for S_GP_Y_158_087
‚úÖ Averaged 1 replicates for S_GP_Z_159_088
‚úÖ Averaged 2 replicates for S_KT_B_70_018
‚úÖ Averaged 2 replicates for S_KT_core2_083
‚úÖ Averaged 1 replicates for S_KT_D_125_112
‚úÖ Averaged 1 replicates for S_KT_E_126_113
‚úÖ Averaged 1 replicates for S_KT_G_127_114
‚úÖ Averaged 1 replicates for S_KT_H_128_115
‚úÖ Averaged 1 replicates for S_KT_I_129_116
‚úÖ Averaged 1 replicates for S_KT_K_130_117
‚úÖ Averaged 1 replicates for S_KT_L_131_118
‚úÖ Averaged 1 replicates for S_KT_M_132_119
‚úÖ Averaged 1 replicates for S_KT_N_133_120
‚úÖ Averaged 1 replicates for S_KT_O_R1_L5_063
‚úÖ Averaged 1 replicates for S_KT_O_R2_L6_064
‚úÖ Averaged 2 replicates for S_MG_B_66_014
‚úÖ Averaged 2 replicates for S_MG_B_66_021
‚úÖ Averaged 2 replicates for S_MG_core1_2_076
‚úÖ Averaged 3 replicates for S_MG_C_19_002
‚úÖ Averaged 2 replicates for S_MG_D_86_041
‚úÖ Averaged 2 replicates for S_MG_E_87_042
‚úÖ Averaged 2 replicates for S_MG_F_88_043
‚úÖ Averaged 2 replicates for S_MG_G_89_044
‚úÖ Averaged 2 replicates for S_MG_H_20_003
‚úÖ Averaged 2 replicates for S_MG_I_90_045
‚úÖ Averaged 2 replicates for S_MG_J_91_046
‚úÖ Averaged 2 replicates for S_MG_K_92_047
‚úÖ Averaged 2 replicates for S_MG_L_93_048
‚úÖ Averaged 2 replicates for S_MG_M_94_049
‚úÖ Averaged 2 replicates for S_MG_O_95_050
‚úÖ Averaged 2 replicates for S_MG_P_96_051
‚úÖ Averaged 2 replicates for S_MM_B_67_015
‚úÖ Averaged 1 replicates for S_MM_B_67_022
‚úÖ Averaged 2 replicates for S_MM_core1_080
‚úÖ Averaged 2 replicates for S_MM_D_97_052
‚úÖ Averaged 2 replicates for S_MM_E_98_053
‚úÖ Averaged 1 replicates for S_MM_F_99_054
‚úÖ Averaged 1 replicates for S_MM_G_100_055
‚úÖ Averaged 1 replicates for S_MM_H_101_056
‚úÖ Averaged 1 replicates for S_MM_I_102_057
‚úÖ Averaged 1 replicates for S_MM_L_103_058
‚úÖ Averaged 1 replicates for S_MM_M_104_059
‚úÖ Averaged 1 replicates for S_MM_N_105_060
‚úÖ Averaged 1 replicates for S_MM_O_106_061
‚úÖ Averaged 2 replicates for S_MM_P_107_091
‚úÖ Averaged 1 replicates for S_MM_Q_108_092
‚úÖ Averaged 1 replicates for S_MM_R_109_093
‚úÖ Averaged 1 replicates for S_MM_S_R1_L1_065
‚úÖ Averaged 1 replicates for S_MM_S_R2_L2_066
‚úÖ Averaged 2 replicates for S_Pyrite_FeS2_141
‚úÖ Averaged 2 replicates for S_TB_B_65_013
‚úÖ Averaged 1 replicates for S_TB_core1_081
‚úÖ Averaged 1 replicates for S_TB_D_170_185
‚úÖ Averaged 1 replicates for S_TB_E_171_186
‚úÖ Averaged 1 replicates for S_TB_F_172_187
‚úÖ Averaged 1 replicates for S_TB_G_173_188
‚úÖ Averaged 1 replicates for S_TB_H_174_189
‚úÖ Averaged 1 replicates for S_TB_J_175_190
‚úÖ Averaged 1 replicates for S_TB_L_176_191
‚úÖ Averaged 1 replicates for S_TB_M_177_192
‚úÖ Averaged 2 replicates for S_TB_N_85_040
‚úÖ Averaged 1 replicates for S_TB_O_R1_L3_067
‚úÖ Averaged 1 replicates for S_TB_O_R2_L4_068
‚úÖ Averaged 1 replicates for S_BY_Jarosite_067
‚úÖ Averaged 2 replicates for S_Pyrite_FeS2_141
‚úÖ Averaged 3 replicates for S_Schw_1_048
‚úÖ Averaged 3 replicates for S_Schw_2_049
‚úÖ Averaged 3 replicates for S_Schw_3_050</code></pre>
</div>
</div>
<div id="322be03d" class="cell" data-execution_count="221">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#averaged_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="xanes-normalization-e0-finding" class="level1">
<h1><strong>XANES NORMALIZATION &amp; E0 FINDING</strong></h1>
<div id="9eb2e7c5" class="cell" data-execution_count="222">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 5Ô∏è‚É£ XANES NORMALIZATION &amp; E0 FINDING ===</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>xanes_results <span class="op">=</span> {}</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sample, df <span class="kw">in</span> averaged_data.items():</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    energy <span class="op">=</span> df[<span class="st">'energy'</span>].values</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> df[<span class="st">'mu_avg'</span>].values</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Larch Group and store data</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> Group()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    g.energy <span class="op">=</span> energy</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    g.mu <span class="op">=</span> mu</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply pre-edge normalization (this modifies 'g' in place)</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    pre_edge(g.energy, g.mu, group<span class="op">=</span>g, <span class="co"># energy, intensity, and the group to treat</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                    pre1 <span class="op">=</span> <span class="op">-</span><span class="dv">50</span>, <span class="co"># the lower bond of the function to fit the pre-edge</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                    pre2 <span class="op">=</span> <span class="op">-</span><span class="dv">20</span>, <span class="co"># the upper bond of the function to fit the pre-edge</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                    norm1 <span class="op">=</span> <span class="dv">40</span>, <span class="co"># the lower bond of the function to fit the post-edge</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                    norm2<span class="op">=</span> <span class="dv">1020</span>, <span class="co"># the upper bond of the function to fit the post-edge</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                    nnorm<span class="op">=</span> <span class="dv">2</span>, <span class="co"># degree for the polynomials</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                    nvict<span class="op">=</span> <span class="dv">4</span> <span class="co"># energy exponent to use for pre-edge fit.</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results in DataFrame</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    df_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'energy'</span>: g.energy,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mu'</span>: g.mu,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pre_edge'</span>: g.pre_edge,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'post_edge'</span>: g.post_edge,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'norm_mu'</span>: g.norm,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'flat'</span>: g.flat,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot XANES normalization</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.pre_edge, label<span class="op">=</span><span class="st">'Pre-Edge'</span>, color<span class="op">=</span><span class="st">'gold'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.post_edge, label<span class="op">=</span><span class="st">'Post-Edge'</span>, color<span class="op">=</span><span class="st">'cornflowerblue'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.mu, label<span class="op">=</span><span class="st">'Raw mu(E)'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.norm, label<span class="op">=</span><span class="st">'Normalized'</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    plt.axvline(g.e0, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'E0: </span><span class="sc">{</span>g<span class="sc">.</span>e0<span class="sc">:.1f}</span><span class="ss"> eV'</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'XANES Normalization - </span><span class="sc">{</span>sample<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'mu(E)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    xanes_results[sample] <span class="op">=</span> {</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">'df'</span>: df_result,</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'e0'</span>: g.e0</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Normalized </span><span class="sc">{</span>sample<span class="sc">}</span><span class="ss"> (E0 = </span><span class="sc">{</span>g<span class="sc">.</span>e0<span class="sc">:.1f}</span><span class="ss"> eV)"</span>)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="co">#print(xanes_results)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_B_69_017 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_D_116_103 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_E_117_104 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_G_118_105 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_H_119_106 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-11.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_J_120_107 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-13.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_K_121_108 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-15.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_L_122_109 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-17.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_M_123_110 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-19.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_O_124_111 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-21.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BC_test_core_078 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-23.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_A_63_009 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-25.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_B_73_038 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-27.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_C_47_004 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-29.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_D_162_177 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-31.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_E_163_178 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-33.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_F_164_179 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-35.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_G_48_005 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-37.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_H_165_180 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-39.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_I_166_181 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-41.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_J_49_007 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-43.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_K_167_182 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-45.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_L_168_183 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-47.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_M_169_184 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-49.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BK_N_50_008 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-51.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CC_B_71_019 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-53.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CC_D_134_121 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-55.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CC_E_135_122 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-57.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CC_G_136_123 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-59.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CC_H_137_124 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-61.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CC_J_138_125 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-63.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CC_L_139_126 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-65.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_B_68_016 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-67.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_core_A_077 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-69.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_core_B_082 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-71.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_core_B_C_079 (E0 = 2471.6 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-73.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_core_B_C_082 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-75.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_D_110_094 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-77.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_D_110_097 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-79.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_E_111_098 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-81.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_G_112_099 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-83.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_H_113_100 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-85.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_J_114_101 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-87.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_CT_K_115_102 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-89.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_AA_160_089 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-91.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_AC_161_090 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-93.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_B_72_020 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-95.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_B_72_023 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-97.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_core3_2_075 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-99.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_D_140_127 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-101.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_E_141_128 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-103.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_F_142_129 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-105.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_G_143_130 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-107.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_H_144_131 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-109.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_I_145_132 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-111.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_K_146_133 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-113.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_L_147_149 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-115.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_M_148_150 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-117.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_N_149_151 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-119.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_P_150_152 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-121.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_Q_151_153 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-123.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_R_152_154 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-125.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_S_153_155 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-127.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_U_154_156 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-129.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_V_155_084 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-131.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_W_156_085 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-133.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_X_157_086 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-135.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_Y_158_087 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-137.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_GP_Z_159_088 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-139.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_B_70_018 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-141.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_core2_083 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-143.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_D_125_112 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-145.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_E_126_113 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-147.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_G_127_114 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-149.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_H_128_115 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-151.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_I_129_116 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-153.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_K_130_117 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-155.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_L_131_118 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-157.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_M_132_119 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-159.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_N_133_120 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-161.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_O_R1_L5_063 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-163.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_KT_O_R2_L6_064 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-165.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_B_66_014 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-167.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_B_66_021 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-169.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_core1_2_076 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-171.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_C_19_002 (E0 = 2481.9 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-173.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_D_86_041 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-175.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_E_87_042 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-177.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_F_88_043 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-179.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_G_89_044 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-181.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_H_20_003 (E0 = 2481.9 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-183.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_I_90_045 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-185.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_J_91_046 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-187.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_K_92_047 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-189.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_L_93_048 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-191.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_M_94_049 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-193.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_O_95_050 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-195.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MG_P_96_051 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-197.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_B_67_015 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-199.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_B_67_022 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-201.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_core1_080 (E0 = 2471.5 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-203.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_D_97_052 (E0 = 2482.1 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-205.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_E_98_053 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-207.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_F_99_054 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-209.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_G_100_055 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-211.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_H_101_056 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-213.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_I_102_057 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-215.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_L_103_058 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-217.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_M_104_059 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-219.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_N_105_060 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-221.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_O_106_061 (E0 = 2471.5 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-223.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_P_107_091 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-225.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_Q_108_092 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-227.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_R_109_093 (E0 = 2471.5 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-229.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_S_R1_L1_065 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-231.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_MM_S_R2_L2_066 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-233.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_Pyrite_FeS2_141 (E0 = 2471.4 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-235.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_B_65_013 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-237.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_core1_081 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-239.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_D_170_185 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-241.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_E_171_186 (E0 = 2482.0 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-243.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_F_172_187 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-245.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_G_173_188 (E0 = 2481.5 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-247.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_H_174_189 (E0 = 2481.8 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-249.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_J_175_190 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-251.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_L_176_191 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-253.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_M_177_192 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-255.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_N_85_040 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-257.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_O_R1_L3_067 (E0 = 2471.3 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-11-output-259.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_TB_O_R2_L4_068 (E0 = 2471.3 eV)</code></pre>
</div>
</div>
</section>
<section id="exafs-analysis-chik-ftr-space" class="level1">
<h1><strong>EXAFS ANALYSIS (chi(k), FT(R-space))</strong></h1>
<div id="eaf4094d" class="cell" data-execution_count="223">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 6Ô∏è‚É£ EXAFS ANALYSIS (chi(k), chi(R)) ===</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>exafs_results <span class="op">=</span> {}</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sample, result <span class="kw">in</span> xanes_results.items():</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> result[<span class="st">'df'</span>]</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚úÖ Ensure energy is sorted</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values(by<span class="op">=</span><span class="st">'energy'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>    energy <span class="op">=</span> df[<span class="st">'energy'</span>].values</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>    norm_mu <span class="op">=</span> df[<span class="st">'norm_mu'</span>].values</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>sample<span class="sc">}</span><span class="ss">: is strictly increasing? </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">all</span>(np.diff(energy) <span class="op">&gt;</span> <span class="dv">0</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Larch Group and store data</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> Group()</span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>    g.energy <span class="op">=</span> energy</span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>    g.mu <span class="op">=</span> norm_mu</span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run EXAFS extraction with autobk (modifies 'g' in place)</span></span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>    autobk(g, rbkg<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fourier Transform to chi(R) (modifies 'g' in place)</span></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>    xftf(g, kmin<span class="op">=</span><span class="dv">2</span>, kmax<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save results</span></span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a>    exafs_results[sample] <span class="op">=</span> {</span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'k'</span>: g.k,</span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chi_k'</span>: g.chi,</span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'r'</span>: g.r,</span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chi_r'</span>: g.chir_mag</span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ EXAFS extracted for </span><span class="sc">{</span>sample<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb146-34"><a href="#cb146-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-35"><a href="#cb146-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"üéâ All samples processed!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>S_BC_B_69_017: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_B_69_017
S_BC_D_116_103: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_D_116_103
S_BC_E_117_104: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_E_117_104
S_BC_G_118_105: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_G_118_105
S_BC_H_119_106: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_H_119_106
S_BC_J_120_107: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_J_120_107
S_BC_K_121_108: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_K_121_108
S_BC_L_122_109: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_L_122_109
S_BC_M_123_110: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_M_123_110
S_BC_O_124_111: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_O_124_111
S_BC_test_core_078: is strictly increasing? True
‚úÖ EXAFS extracted for S_BC_test_core_078
S_BK_A_63_009: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_A_63_009
S_BK_B_73_038: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_B_73_038
S_BK_C_47_004: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_C_47_004
S_BK_D_162_177: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_D_162_177
S_BK_E_163_178: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_E_163_178
S_BK_F_164_179: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_F_164_179
S_BK_G_48_005: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_G_48_005
S_BK_H_165_180: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_H_165_180
S_BK_I_166_181: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_I_166_181
S_BK_J_49_007: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_J_49_007
S_BK_K_167_182: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_K_167_182
S_BK_L_168_183: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_L_168_183
S_BK_M_169_184: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_M_169_184
S_BK_N_50_008: is strictly increasing? True
‚úÖ EXAFS extracted for S_BK_N_50_008
S_CC_B_71_019: is strictly increasing? True
‚úÖ EXAFS extracted for S_CC_B_71_019
S_CC_D_134_121: is strictly increasing? True
‚úÖ EXAFS extracted for S_CC_D_134_121
S_CC_E_135_122: is strictly increasing? True
‚úÖ EXAFS extracted for S_CC_E_135_122
S_CC_G_136_123: is strictly increasing? True
‚úÖ EXAFS extracted for S_CC_G_136_123
S_CC_H_137_124: is strictly increasing? True
‚úÖ EXAFS extracted for S_CC_H_137_124
S_CC_J_138_125: is strictly increasing? True
‚úÖ EXAFS extracted for S_CC_J_138_125
S_CC_L_139_126: is strictly increasing? True
‚úÖ EXAFS extracted for S_CC_L_139_126
S_CT_B_68_016: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_B_68_016
S_CT_core_A_077: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_core_A_077
S_CT_core_B_082: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_core_B_082
S_CT_core_B_C_079: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_core_B_C_079
S_CT_core_B_C_082: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_core_B_C_082
S_CT_D_110_094: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_D_110_094
S_CT_D_110_097: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_D_110_097
S_CT_E_111_098: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_E_111_098
S_CT_G_112_099: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_G_112_099
S_CT_H_113_100: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_H_113_100
S_CT_J_114_101: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_J_114_101
S_CT_K_115_102: is strictly increasing? True
‚úÖ EXAFS extracted for S_CT_K_115_102
S_GP_AA_160_089: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_AA_160_089
S_GP_AC_161_090: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_AC_161_090
S_GP_B_72_020: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_B_72_020
S_GP_B_72_023: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_B_72_023
S_GP_core3_2_075: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_core3_2_075
S_GP_D_140_127: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_D_140_127
S_GP_E_141_128: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_E_141_128
S_GP_F_142_129: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_F_142_129
S_GP_G_143_130: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_G_143_130
S_GP_H_144_131: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_H_144_131
S_GP_I_145_132: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_I_145_132
S_GP_K_146_133: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_K_146_133
S_GP_L_147_149: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_L_147_149
S_GP_M_148_150: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_M_148_150
S_GP_N_149_151: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_N_149_151
S_GP_P_150_152: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_P_150_152
S_GP_Q_151_153: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_Q_151_153
S_GP_R_152_154: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_R_152_154
S_GP_S_153_155: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_S_153_155
S_GP_U_154_156: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_U_154_156
S_GP_V_155_084: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_V_155_084
S_GP_W_156_085: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_W_156_085
S_GP_X_157_086: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_X_157_086
S_GP_Y_158_087: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_Y_158_087
S_GP_Z_159_088: is strictly increasing? True
‚úÖ EXAFS extracted for S_GP_Z_159_088
S_KT_B_70_018: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_B_70_018
S_KT_core2_083: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_core2_083
S_KT_D_125_112: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_D_125_112
S_KT_E_126_113: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_E_126_113
S_KT_G_127_114: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_G_127_114
S_KT_H_128_115: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_H_128_115
S_KT_I_129_116: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_I_129_116
S_KT_K_130_117: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_K_130_117
S_KT_L_131_118: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_L_131_118
S_KT_M_132_119: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_M_132_119
S_KT_N_133_120: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_N_133_120
S_KT_O_R1_L5_063: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_O_R1_L5_063
S_KT_O_R2_L6_064: is strictly increasing? True
‚úÖ EXAFS extracted for S_KT_O_R2_L6_064
S_MG_B_66_014: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_B_66_014
S_MG_B_66_021: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_B_66_021
S_MG_core1_2_076: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_core1_2_076
S_MG_C_19_002: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_C_19_002
S_MG_D_86_041: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_D_86_041
S_MG_E_87_042: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_E_87_042
S_MG_F_88_043: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_F_88_043
S_MG_G_89_044: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_G_89_044
S_MG_H_20_003: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_H_20_003
S_MG_I_90_045: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_I_90_045
S_MG_J_91_046: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_J_91_046
S_MG_K_92_047: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_K_92_047
S_MG_L_93_048: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_L_93_048
S_MG_M_94_049: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_M_94_049
S_MG_O_95_050: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_O_95_050
S_MG_P_96_051: is strictly increasing? True
‚úÖ EXAFS extracted for S_MG_P_96_051
S_MM_B_67_015: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_B_67_015
S_MM_B_67_022: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_B_67_022
S_MM_core1_080: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_core1_080
S_MM_D_97_052: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_D_97_052
S_MM_E_98_053: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_E_98_053
S_MM_F_99_054: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_F_99_054
S_MM_G_100_055: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_G_100_055
S_MM_H_101_056: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_H_101_056
S_MM_I_102_057: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_I_102_057
S_MM_L_103_058: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_L_103_058
S_MM_M_104_059: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_M_104_059
S_MM_N_105_060: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_N_105_060
S_MM_O_106_061: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_O_106_061
S_MM_P_107_091: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_P_107_091
S_MM_Q_108_092: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_Q_108_092
S_MM_R_109_093: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_R_109_093
S_MM_S_R1_L1_065: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_S_R1_L1_065
S_MM_S_R2_L2_066: is strictly increasing? True
‚úÖ EXAFS extracted for S_MM_S_R2_L2_066
S_Pyrite_FeS2_141: is strictly increasing? True
‚úÖ EXAFS extracted for S_Pyrite_FeS2_141
S_TB_B_65_013: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_B_65_013
S_TB_core1_081: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_core1_081
S_TB_D_170_185: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_D_170_185
S_TB_E_171_186: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_E_171_186
S_TB_F_172_187: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_F_172_187
S_TB_G_173_188: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_G_173_188
S_TB_H_174_189: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_H_174_189
S_TB_J_175_190: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_J_175_190
S_TB_L_176_191: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_L_176_191
S_TB_M_177_192: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_M_177_192
S_TB_N_85_040: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_N_85_040
S_TB_O_R1_L3_067: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_O_R1_L3_067
S_TB_O_R2_L4_068: is strictly increasing? True
‚úÖ EXAFS extracted for S_TB_O_R2_L4_068
üéâ All samples processed!</code></pre>
</div>
</div>
</section>
<section id="defining-mine-tailings-information" class="level1">
<h1><strong><em>Defining mine tailings information</em></strong></h1>
<div id="7c003c5f" class="cell" data-execution_count="224">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining mine site full names</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>mine_sites <span class="op">=</span> [</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Barker, MT"</span>, <span class="st">"Black Butte, OR"</span>, <span class="st">"Bonnie Claire, NV"</span>, <span class="st">"Charcoal Canyon, AZ"</span>,</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Crystal, MT"</span>, <span class="st">"Formosa, OR"</span>, <span class="st">"Gold Point, NV"</span>, <span class="st">"Iron King, AZ"</span>,</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Iron Mountain, CA"</span>, <span class="st">"Keating, MT"</span>, <span class="st">"Mammoth, MT"</span>, <span class="st">"Marigold, CA"</span>, <span class="st">"Tybo, NV"</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining its abbreviations</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>mine_abbreviations <span class="op">=</span> [<span class="st">"BK"</span>, <span class="st">"BB"</span>, <span class="st">"BC"</span>, <span class="st">"CC"</span>, <span class="st">"CT"</span>, <span class="st">"FM"</span>, <span class="st">"GP"</span>, <span class="st">"IK"</span>, <span class="st">"IM"</span>, <span class="st">"KT"</span>, <span class="st">"MM"</span>, <span class="st">"MG"</span>, <span class="st">"TB"</span>]</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining standard colors for each site</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>mine_colors <span class="op">=</span> [</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>, <span class="st">"#7f7f7f"</span>, <span class="st">"#00CED1"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#e377c2"</span>,</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FF1493"</span>, <span class="st">"#FF7F00"</span>, <span class="st">"#00FF00"</span>, <span class="st">"brown"</span>, <span class="st">"#ffcc33"</span>,</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#0000FF"</span>, <span class="st">"#87CEEB"</span>, <span class="st">"#008B00"</span></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping from full name to color</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>mine_color_mapping <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(mine_sites, mine_colors))</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping abbreviation to color if needed</span></span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>mine_abbrev_color_mapping <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(mine_abbreviations, mine_colors))</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sorting-and-plotting" class="level1">
<h1><strong>Sorting and plotting</strong></h1>
<p>Reading samples from different sites, identifyng the ones from the same site, grouping them the same plot to plot them stacked.</p>
<div id="3909a45f" class="cell" data-execution_count="225">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co"># List of sample names</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>sample_names <span class="op">=</span> <span class="bu">list</span>(xanes_results.keys()) </span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the mine abbreviation from the sample name (e.g., 'S_BC_A_001_001')</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_abbreviation(sample_name):</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(<span class="vs">r'_([A-Z]</span><span class="sc">{2}</span><span class="vs">)_'</span>, sample_name)</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> match.group(<span class="dv">1</span>) <span class="cf">if</span> match <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Looping over mines and plotting all samples from the same mine together</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mine_abbrev, color <span class="kw">in</span> mine_abbrev_color_mapping.items():</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Getting sample names that belong to this mine site</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> sample_names <span class="cf">if</span> extract_abbreviation(s) <span class="op">==</span> mine_abbrev]</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Custom sort order that:</span></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#‚úÖ Sorts samples alphabetically by their full names;</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#‚úÖ But any samples starting with AA, AB, AC come after Z;</span></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#‚úÖ And samples that include "core" also come after everything else.</span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> custom_sort_key(sample_name):</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>        name_upper <span class="op">=</span> sample_name.upper()</span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Checking if 'core' is in the name (like core, core1, core2, coreX...)</span></span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">any</span>(part.startswith(<span class="st">'CORE'</span>) <span class="cf">for</span> part <span class="kw">in</span> name_upper.split(<span class="st">'_'</span>)):</span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a>            category <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Detecting if AA / AB / AC after the mine abbrev</span></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">any</span>(part <span class="kw">in</span> (<span class="st">'AA'</span>, <span class="st">'AB'</span>, <span class="st">'AC'</span>) <span class="cf">for</span> part <span class="kw">in</span> name_upper.split(<span class="st">'_'</span>)):</span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a>            category <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>            category <span class="op">=</span> <span class="dv">0</span>  <span class="co"># normal sample</span></span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (category, name_upper)</span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚úÖ Applying custom sort</span></span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> <span class="bu">sorted</span>(mine_samples, key<span class="op">=</span>custom_sort_key)</span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-38"><a href="#cb149-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating a custom colormap from orange to grey</span></span>
<span id="cb149-39"><a href="#cb149-39" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">"orange"</span>, <span class="st">"grey"</span>]</span>
<span id="cb149-40"><a href="#cb149-40" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> LinearSegmentedColormap.from_list(<span class="st">"orange_grey"</span>, colors)</span>
<span id="cb149-41"><a href="#cb149-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-42"><a href="#cb149-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generating N colors (N = number of samples)</span></span>
<span id="cb149-43"><a href="#cb149-43" aria-hidden="true" tabindex="-1"></a>    n_samples <span class="op">=</span> <span class="bu">len</span>(mine_samples)</span>
<span id="cb149-44"><a href="#cb149-44" aria-hidden="true" tabindex="-1"></a>    color_list <span class="op">=</span> [cmap(i <span class="op">/</span> (n_samples <span class="op">-</span> <span class="dv">1</span>)) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_samples)]</span>
<span id="cb149-45"><a href="#cb149-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-46"><a href="#cb149-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assigning colors based on sorted order</span></span>
<span id="cb149-47"><a href="#cb149-47" aria-hidden="true" tabindex="-1"></a>    sample_color_map <span class="op">=</span> {sample: color_list[idx] <span class="cf">for</span> idx, sample <span class="kw">in</span> <span class="bu">enumerate</span>(mine_samples)}</span>
<span id="cb149-48"><a href="#cb149-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-49"><a href="#cb149-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-50"><a href="#cb149-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> mine_samples:</span>
<span id="cb149-51"><a href="#cb149-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚ö†Ô∏è No samples found for </span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb149-52"><a href="#cb149-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb149-53"><a href="#cb149-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-54"><a href="#cb149-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotting XANES</span></span>
<span id="cb149-55"><a href="#cb149-55" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb149-56"><a href="#cb149-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sample <span class="kw">in</span> mine_samples:</span>
<span id="cb149-57"><a href="#cb149-57" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> xanes_results[sample][<span class="st">'df'</span>]</span>
<span id="cb149-58"><a href="#cb149-58" aria-hidden="true" tabindex="-1"></a>        plt.plot(df[<span class="st">'energy'</span>], df[<span class="st">'norm_mu'</span>], label<span class="op">=</span>sample, color<span class="op">=</span>sample_color_map[sample])</span>
<span id="cb149-59"><a href="#cb149-59" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"XANES - </span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb149-60"><a href="#cb149-60" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb149-61"><a href="#cb149-61" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Normalized mu(E)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb149-62"><a href="#cb149-62" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb149-63"><a href="#cb149-63" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb149-64"><a href="#cb149-64" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ö†Ô∏è No samples found for BB</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ö†Ô∏è No samples found for FM</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ö†Ô∏è No samples found for IK
‚ö†Ô∏è No samples found for IM</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-11.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-14-output-12.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="alphabetical-order" class="level1">
<h1><strong>Alphabetical order</strong></h1>
<p>Function to sort the samples on the correct horizon order</p>
<div id="c5b24a1b" class="cell" data-execution_count="226">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Custom sort order that:</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co">#‚úÖ Sorts samples alphabetically by their full names;</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">#‚úÖ But any samples starting with AA, AB, AC come after Z;</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co">#‚úÖ And samples that include "core" also come after everything else.</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_sort_key(sample_name):</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>    name_upper <span class="op">=</span> sample_name.upper()</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Detect if it's a 'core' sample</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'CORE'</span> <span class="kw">in</span> name_upper:</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Detect if AA / AB / AC after the mine abbrev (split by '_')</span></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Split by underscore to find the part after the mine abbrev</span></span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>        parts <span class="op">=</span> name_upper.split(<span class="st">'_'</span>)</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Safe: look for AA/AB/AC in any part</span></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>        found_special <span class="op">=</span> <span class="bu">any</span>(p <span class="kw">in</span> (<span class="st">'AA'</span>, <span class="st">'AB'</span>, <span class="st">'AC'</span>) <span class="cf">for</span> p <span class="kw">in</span> parts)</span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> found_special:</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>            category <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>            category <span class="op">=</span> <span class="dv">0</span>  <span class="co"># normal sample</span></span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (category, name_upper)</span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a>mine_samples_sorted <span class="op">=</span> <span class="bu">sorted</span>(mine_samples, key<span class="op">=</span>custom_sort_key)</span>
<span id="cb153-29"><a href="#cb153-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mine_samples_sorted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['S_TB_B_65_013', 'S_TB_D_170_185', 'S_TB_E_171_186', 'S_TB_F_172_187', 'S_TB_G_173_188', 'S_TB_H_174_189', 'S_TB_J_175_190', 'S_TB_L_176_191', 'S_TB_M_177_192', 'S_TB_N_85_040', 'S_TB_O_R1_L3_067', 'S_TB_O_R2_L4_068', 'S_TB_core1_081']</code></pre>
</div>
</div>
</section>
<section id="compute-second-derivative-of-pre-edge" class="level1">
<h1>Compute second derivative of pre-edge</h1>
<div id="27b5fe11" class="cell" data-execution_count="227">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> gaussian_filter1d</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-edge range for derivative</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>pre_edge_min <span class="op">=</span> <span class="dv">2475</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>pre_edge_max <span class="op">=</span> <span class="fl">2477.5</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Offset for stacked plot</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Mines that need larger vertical spacing between curves</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>wide_offset_mines <span class="op">=</span> [<span class="st">'TB'</span>, <span class="st">'MG'</span>, <span class="st">'MM'</span>, <span class="st">'KT'</span>, <span class="st">'CT'</span>]</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>offset_big <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>offset_small <span class="op">=</span> <span class="fl">0.06</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mine_abbrev <span class="kw">in</span> mine_abbreviations:</span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get all samples for this mine</span></span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> [sample <span class="cf">for</span> sample <span class="kw">in</span> xanes_results.keys() <span class="cf">if</span> mine_abbrev <span class="kw">in</span> sample]</span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> <span class="bu">sorted</span>(mine_samples, key<span class="op">=</span>custom_sort_key)</span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> mine_samples:</span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> mine_abbrev_color_mapping[mine_abbrev]</span>
<span id="cb155-24"><a href="#cb155-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb155-25"><a href="#cb155-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use larger offset only for specific mines</span></span>
<span id="cb155-26"><a href="#cb155-26" aria-hidden="true" tabindex="-1"></a>    offset_step <span class="op">=</span> offset_big <span class="cf">if</span> mine_abbrev <span class="kw">in</span> wide_offset_mines <span class="cf">else</span> offset_small</span>
<span id="cb155-27"><a href="#cb155-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-28"><a href="#cb155-28" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">10</span>))  <span class="co"># wider for better x resolution</span></span>
<span id="cb155-29"><a href="#cb155-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-30"><a href="#cb155-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, sample <span class="kw">in</span> <span class="bu">enumerate</span>(mine_samples):</span>
<span id="cb155-31"><a href="#cb155-31" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> xanes_results[sample][<span class="st">'df'</span>]</span>
<span id="cb155-32"><a href="#cb155-32" aria-hidden="true" tabindex="-1"></a>        energy <span class="op">=</span> df[<span class="st">'energy'</span>].values</span>
<span id="cb155-33"><a href="#cb155-33" aria-hidden="true" tabindex="-1"></a>        norm_mu <span class="op">=</span> df[<span class="st">'norm_mu'</span>].values</span>
<span id="cb155-34"><a href="#cb155-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-35"><a href="#cb155-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply pre-edge mask</span></span>
<span id="cb155-36"><a href="#cb155-36" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> (energy <span class="op">&gt;=</span> pre_edge_min) <span class="op">&amp;</span> (energy <span class="op">&lt;=</span> pre_edge_max)</span>
<span id="cb155-37"><a href="#cb155-37" aria-hidden="true" tabindex="-1"></a>        energy_pre <span class="op">=</span> energy[mask]</span>
<span id="cb155-38"><a href="#cb155-38" aria-hidden="true" tabindex="-1"></a>        mu_pre <span class="op">=</span> norm_mu[mask]</span>
<span id="cb155-39"><a href="#cb155-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-40"><a href="#cb155-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Smooth and compute second derivative</span></span>
<span id="cb155-41"><a href="#cb155-41" aria-hidden="true" tabindex="-1"></a>        mu_smooth <span class="op">=</span> gaussian_filter1d(mu_pre, sigma<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb155-42"><a href="#cb155-42" aria-hidden="true" tabindex="-1"></a>        d1 <span class="op">=</span> np.gradient(mu_smooth, energy_pre)</span>
<span id="cb155-43"><a href="#cb155-43" aria-hidden="true" tabindex="-1"></a>        d2 <span class="op">=</span> np.gradient(d1, energy_pre)</span>
<span id="cb155-44"><a href="#cb155-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-45"><a href="#cb155-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply vertical offset for stacking</span></span>
<span id="cb155-46"><a href="#cb155-46" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">=</span> idx <span class="op">*</span> offset_step</span>
<span id="cb155-47"><a href="#cb155-47" aria-hidden="true" tabindex="-1"></a>        plt.plot(energy_pre, d2 <span class="op">-</span> offset, label<span class="op">=</span>sample, color<span class="op">=</span>color, lw<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb155-48"><a href="#cb155-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-49"><a href="#cb155-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Label each curve</span></span>
<span id="cb155-50"><a href="#cb155-50" aria-hidden="true" tabindex="-1"></a>        plt.text(energy_pre.<span class="bu">min</span>() <span class="op">+</span> <span class="fl">0.3</span>, <span class="op">-</span>offset <span class="op">+</span> <span class="fl">0.005</span>, sample,</span>
<span id="cb155-51"><a href="#cb155-51" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb155-52"><a href="#cb155-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-53"><a href="#cb155-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb155-54"><a href="#cb155-54" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss"> - 2nd Derivative of Pre-Edge"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb155-55"><a href="#cb155-55" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Energy (eV)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb155-56"><a href="#cb155-56" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"d¬≤Œº/dE¬≤ (stacked)"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb155-57"><a href="#cb155-57" aria-hidden="true" tabindex="-1"></a>    plt.xlim(pre_edge_min, pre_edge_max)</span>
<span id="cb155-58"><a href="#cb155-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.xticks(np.arange(pre_edge_min, pre_edge_max + 0.1, 0.1))  # tick positions</span></span>
<span id="cb155-59"><a href="#cb155-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.tick_params(axis='x', which='both', bottom=True, top=False, labelbottom=False)  # hide numbers  # ticks every 0.1 eV</span></span>
<span id="cb155-60"><a href="#cb155-60" aria-hidden="true" tabindex="-1"></a>    plt.yticks([])  <span class="co"># Hide y-axis ticks for stacked view</span></span>
<span id="cb155-61"><a href="#cb155-61" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb155-62"><a href="#cb155-62" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb155-63"><a href="#cb155-63" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb155-64"><a href="#cb155-64" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb155-65"><a href="#cb155-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-66"><a href="#cb155-66" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> plt.gca()  <span class="co"># get current axis object</span></span>
<span id="cb155-67"><a href="#cb155-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-68"><a href="#cb155-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># X-axis ticks every 0.1 (minor) and labels every 0.5 (major)</span></span>
<span id="cb155-69"><a href="#cb155-69" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(pre_edge_min, pre_edge_max)</span>
<span id="cb155-70"><a href="#cb155-70" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(pre_edge_min, pre_edge_max <span class="op">+</span> <span class="fl">0.1</span>, <span class="fl">0.1</span>), minor<span class="op">=</span><span class="va">True</span>)  <span class="co"># minor ticks</span></span>
<span id="cb155-71"><a href="#cb155-71" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(pre_edge_min, pre_edge_max <span class="op">+</span> <span class="fl">0.5</span>, <span class="fl">0.5</span>))  <span class="co"># major ticks with labels</span></span>
<span id="cb155-72"><a href="#cb155-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-73"><a href="#cb155-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep tick marks, but label only the major ones</span></span>
<span id="cb155-74"><a href="#cb155-74" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, which<span class="op">=</span><span class="st">'major'</span>, bottom<span class="op">=</span><span class="va">True</span>, labelbottom<span class="op">=</span><span class="va">True</span>, length<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb155-75"><a href="#cb155-75" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, which<span class="op">=</span><span class="st">'minor'</span>, bottom<span class="op">=</span><span class="va">True</span>, labelbottom<span class="op">=</span><span class="va">False</span>, length<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb155-76"><a href="#cb155-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-77"><a href="#cb155-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Disable vertical grid lines, enable horizontal grid lines</span></span>
<span id="cb155-78"><a href="#cb155-78" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb155-79"><a href="#cb155-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-80"><a href="#cb155-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-81"><a href="#cb155-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save plot</span></span>
<span id="cb155-82"><a href="#cb155-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.savefig(f"{save_folder}\\{mine_abbrev}_S_preedge_2nd_deriv.png", dpi=300, bbox_inches='tight')</span></span>
<span id="cb155-83"><a href="#cb155-83" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb155-84"><a href="#cb155-84" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-16-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-xanes" class="level1">
<h1><strong>Plotting XANES</strong></h1>
<div id="5353694e" class="cell" data-execution_count="228">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding E0 values for sulfates, sulfides and pyrite, to plot as reference vertical lines</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Import pandas to work with dataframes</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the sulfur K-edge table as a pandas DataFrame</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>sulfur_edges_table <span class="op">=</span> pd.DataFrame({</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mineral"</span>: [</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Anglesite"</span>, <span class="st">"Chalcopyrite"</span>, <span class="st">"Coquimbite"</span>, <span class="st">"Galena"</span>, <span class="st">"Gypsum"</span>, <span class="st">"Jarosite"</span>,</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Marcasite"</span>, <span class="st">"Melanterite"</span>, <span class="st">"Natrojarosite"</span>, <span class="st">"Pyrite"</span>, <span class="st">"Pyrrhotite-4C"</span>, <span class="st">"Sphalerite"</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sulfur_K_edge_eV"</span>: [</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>        <span class="fl">2481.8</span>, <span class="fl">2472.0</span>, <span class="fl">2482.6</span>, <span class="fl">2472.7</span>, <span class="fl">2482.5</span>, <span class="fl">2482.8</span>,</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>        <span class="fl">2472.0</span>, <span class="fl">2482.2</span>, <span class="fl">2482.7</span>, <span class="fl">2472.1</span>, <span class="fl">2470.2</span>, <span class="fl">2473.8</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Reference"</span>: [</span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/anglesite/anglesite.pdf"</span>,</span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://xasdb.lightsource.ca/"</span>,</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/coquimbite/coquimbite.pdf"</span>,</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/galena/galena.pdf"</span>,</span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/gypsum/gypsum.pdf"</span>,</span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/jarosite/jarosite.pdf"</span>,</span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/marcassite/marcassite.pdf"</span>,</span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/melanterite/melanterite.pdf"</span>,</span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/natrojarosite/natrojarosite.pdf"</span>,</span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/pyrite/pyrite.pdf"</span>,</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/pyrrhotite-4C/pyrrhotite4C.pdf"</span>,</span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://www.esrf.fr/files/live/sites/www/files/UsersAndScience/Experiments/XNP/ID21/php/sphalerite/sphalerite.pdf"</span></span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Eliminate desired minerals from table</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>sulfur_edges_table <span class="op">=</span> sulfur_edges_table[sulfur_edges_table[<span class="st">"Mineral"</span>] <span class="op">!=</span> <span class="st">"Marcasite"</span>]</span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table</span></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>sulfur_edges_table</span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="228">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mineral</th>
<th data-quarto-table-cell-role="th">Sulfur_K_edge_eV</th>
<th data-quarto-table-cell-role="th">Reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Anglesite</td>
<td>2481.8</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Chalcopyrite</td>
<td>2472.0</td>
<td>https://xasdb.lightsource.ca/</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Coquimbite</td>
<td>2482.6</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Galena</td>
<td>2472.7</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Gypsum</td>
<td>2482.5</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Jarosite</td>
<td>2482.8</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Melanterite</td>
<td>2482.2</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Natrojarosite</td>
<td>2482.7</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Pyrite</td>
<td>2472.1</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Pyrrhotite-4C</td>
<td>2470.2</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>Sphalerite</td>
<td>2473.8</td>
<td>https://www.esrf.fr/files/live/sites/www/files...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="9c883871" class="cell" data-execution_count="229">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom color mapping for selected minerals (you can expand it)</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gypsum"</span>: <span class="st">"#CCCC00"</span>,           <span class="co"># approximation of "yellow3"</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pyrite"</span>: <span class="st">"#CAB2D6"</span>,           <span class="co"># already valid hex</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Chalcopyrite"</span>: <span class="st">"#FFD700"</span>,     <span class="co"># "gold" instead of "gold1"</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sphalerite"</span>: <span class="st">"darkturquoise"</span>, <span class="co"># standard name</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Jarosite"</span>: <span class="st">"deeppink"</span>,        <span class="co"># closest valid to "deeppink1"</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Natrojarosite"</span>: <span class="st">"blue"</span>,     <span class="co"># valid</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Anglesite"</span>: <span class="st">"lightcoral"</span>,     <span class="co"># valid</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Galena"</span>: <span class="st">"darkolivegreen"</span>,    <span class="co"># valid (no "darkolivegreen4" in Python)</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Coquimbite"</span>: <span class="st">"orchid"</span>,        <span class="co"># closest to "orchid3"</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Melanterite"</span>: <span class="st">"orange"</span>,       <span class="co"># valid</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Marcasite"</span>: <span class="st">"#FB9A99"</span>,        <span class="co"># valid hex from your R palette</span></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pyrrhotite-4C"</span>: <span class="st">"gray"</span>        <span class="co"># closest to "gray40"</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the vertical_lines list</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>vertical_lines <span class="op">=</span> []</span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> sulfur_edges_table.iterrows():</span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>    mineral <span class="op">=</span> row[<span class="st">"Mineral"</span>]</span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>    e0 <span class="op">=</span> row[<span class="st">"Sulfur_K_edge_eV"</span>]</span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>mineral<span class="sc">}</span><span class="ss"> (~</span><span class="sc">{</span>e0<span class="sc">:.1f}</span><span class="ss"> eV)"</span></span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> color_map.get(mineral, <span class="st">"gray"</span>)  <span class="co"># default color if not in map</span></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>    vertical_lines.append({<span class="st">'e0'</span>: e0, <span class="st">'label'</span>: label, <span class="st">'color'</span>: color})</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the list</span></span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a><span class="co">#vertical_lines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="82b44835" class="cell" data-execution_count="230">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2Ô∏è‚É£ Plotting Function: XANES</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the offset for stacking plots</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>offset_step <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through mine abbreviations</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mine_abbrev <span class="kw">in</span> mine_abbreviations:</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all samples that include this abbreviation</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> [sample <span class="cf">for</span> sample <span class="kw">in</span> xanes_results.keys() <span class="cf">if</span> mine_abbrev <span class="kw">in</span> sample]</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom sort</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> <span class="bu">sorted</span>(mine_samples, key<span class="op">=</span>custom_sort_key)</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> mine_samples:</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span>  <span class="co"># skip if no samples found</span></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> mine_abbrev_color_mapping[mine_abbrev]</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, sample <span class="kw">in</span> <span class="bu">enumerate</span>(mine_samples):</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> xanes_results[sample][<span class="st">'df'</span>]</span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Offset each plot vertically</span></span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">=</span> idx <span class="op">*</span> offset_step</span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot normalized mu(E) with offset</span></span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a>        plt.plot(df[<span class="st">'energy'</span>], df[<span class="st">'norm_mu'</span>] <span class="op">-</span> offset, label<span class="op">=</span>sample, color<span class="op">=</span>color, lw<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add label next to each curve</span></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a>        plt.text(df[<span class="st">'energy'</span>].<span class="bu">min</span>()<span class="op">+</span><span class="dv">16</span>, <span class="op">-</span>offset <span class="op">+</span> <span class="fl">0.1</span>, sample, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get Y-axis upper limit to place the label at the top</span></span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a>    y_max <span class="op">=</span> plt.gca().get_ylim()[<span class="dv">1</span>]</span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚ûï Add vertical lines + repel labels</span></span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a>    spacing <span class="op">=</span> <span class="fl">0.5</span>  <span class="co"># adjust this for more/less space between labels</span></span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(vertical_lines):</span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a>        plt.axvline(line[<span class="st">'e0'</span>], color<span class="op">=</span>line[<span class="st">'color'</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, lw<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>        plt.text(line[<span class="st">'e0'</span>], y_max <span class="op">+</span> spacing <span class="op">*</span> (<span class="bu">len</span>(vertical_lines) <span class="op">-</span> i),</span>
<span id="cb158-41"><a href="#cb158-41" aria-hidden="true" tabindex="-1"></a>                line[<span class="st">'label'</span>], color<span class="op">=</span>line[<span class="st">'color'</span>],</span>
<span id="cb158-42"><a href="#cb158-42" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb158-43"><a href="#cb158-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-44"><a href="#cb158-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Expand Y-limit to fit the tallest label</span></span>
<span id="cb158-45"><a href="#cb158-45" aria-hidden="true" tabindex="-1"></a>    plt.ylim(top<span class="op">=</span>y_max <span class="op">+</span> spacing <span class="op">*</span> (<span class="bu">len</span>(vertical_lines) <span class="op">+</span> <span class="fl">0.05</span>))</span>
<span id="cb158-46"><a href="#cb158-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-47"><a href="#cb158-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb158-48"><a href="#cb158-48" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss"> - S K-Œ± XANES"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb158-49"><a href="#cb158-49" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Energy (eV)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb158-50"><a href="#cb158-50" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Normalized Absorbance Œº(E)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb158-51"><a href="#cb158-51" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="dv">2465</span>, <span class="dv">2490</span>)  <span class="co"># &lt;-- set energy range here</span></span>
<span id="cb158-52"><a href="#cb158-52" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb158-53"><a href="#cb158-53" aria-hidden="true" tabindex="-1"></a>    plt.yticks([])  <span class="co"># hide y-axis ticks (stacked style)</span></span>
<span id="cb158-54"><a href="#cb158-54" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb158-55"><a href="#cb158-55" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb158-56"><a href="#cb158-56" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb158-57"><a href="#cb158-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.ylim(top=y_max + 0.5) # Expand y-limit to fit top labels if needed</span></span>
<span id="cb158-58"><a href="#cb158-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-59"><a href="#cb158-59" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb158-60"><a href="#cb158-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save XANES plot</span></span>
<span id="cb158-61"><a href="#cb158-61" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="ss">f"</span><span class="sc">{</span>save_folder<span class="sc">}</span><span class="ch">\\</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">_S_XANES_plot.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb158-62"><a href="#cb158-62" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-19-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2391077e" class="cell" data-execution_count="231">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2Ô∏è‚É£ Plotting Function: XANES Sulfates</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the list of known sulfide minerals</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>sulfide_minerals <span class="op">=</span> [</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pyrite"</span>, <span class="st">"Chalcopyrite"</span>, <span class="st">"Sphalerite"</span>, <span class="st">"Galena"</span>, <span class="st">"Pyrrhotite-4C"</span>, <span class="st">"Marcasite"</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter vertical_lines to exclude sulfides</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>vertical_lines_no_sulfides <span class="op">=</span> [</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>    line <span class="cf">for</span> line <span class="kw">in</span> vertical_lines</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">any</span>(sulfide <span class="kw">in</span> line[<span class="st">'label'</span>] <span class="cf">for</span> sulfide <span class="kw">in</span> sulfide_minerals)</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through mine abbreviations</span></span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mine_abbrev <span class="kw">in</span> mine_abbreviations:</span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all samples that include this abbreviation</span></span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> [sample <span class="cf">for</span> sample <span class="kw">in</span> xanes_results.keys() <span class="cf">if</span> mine_abbrev <span class="kw">in</span> sample]</span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom sort</span></span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> <span class="bu">sorted</span>(mine_samples, key<span class="op">=</span>custom_sort_key)</span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> mine_samples:</span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span>  <span class="co"># skip if no samples found</span></span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> mine_abbrev_color_mapping[mine_abbrev]</span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, sample <span class="kw">in</span> <span class="bu">enumerate</span>(mine_samples):</span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> xanes_results[sample][<span class="st">'df'</span>]</span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Offset each plot vertically</span></span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">=</span> idx <span class="op">*</span> offset_step</span>
<span id="cb159-37"><a href="#cb159-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot normalized mu(E) with offset</span></span>
<span id="cb159-38"><a href="#cb159-38" aria-hidden="true" tabindex="-1"></a>        plt.plot(df[<span class="st">'energy'</span>], df[<span class="st">'norm_mu'</span>] <span class="op">-</span> offset, label<span class="op">=</span>sample, color<span class="op">=</span>color, lw<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb159-39"><a href="#cb159-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add label next to each curve</span></span>
<span id="cb159-40"><a href="#cb159-40" aria-hidden="true" tabindex="-1"></a>        plt.text(df[<span class="st">'energy'</span>].<span class="bu">min</span>()<span class="op">+</span><span class="dv">36</span>, <span class="op">-</span>offset <span class="op">+</span> <span class="fl">0.1</span>, sample, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb159-41"><a href="#cb159-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-42"><a href="#cb159-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-43"><a href="#cb159-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get Y-axis upper limit to place the label at the top</span></span>
<span id="cb159-44"><a href="#cb159-44" aria-hidden="true" tabindex="-1"></a>    y_max <span class="op">=</span> plt.gca().get_ylim()[<span class="dv">1</span>]</span>
<span id="cb159-45"><a href="#cb159-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-46"><a href="#cb159-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ‚ûï Add vertical lines + repel labels</span></span>
<span id="cb159-47"><a href="#cb159-47" aria-hidden="true" tabindex="-1"></a>    spacing <span class="op">=</span> <span class="fl">0.5</span>  <span class="co"># adjust this for more/less space between labels</span></span>
<span id="cb159-48"><a href="#cb159-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(vertical_lines_no_sulfides):</span>
<span id="cb159-49"><a href="#cb159-49" aria-hidden="true" tabindex="-1"></a>        plt.axvline(line[<span class="st">'e0'</span>], color<span class="op">=</span>line[<span class="st">'color'</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, lw<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb159-50"><a href="#cb159-50" aria-hidden="true" tabindex="-1"></a>        plt.text(line[<span class="st">'e0'</span>], y_max <span class="op">+</span> spacing <span class="op">*</span> (<span class="bu">len</span>(vertical_lines_no_sulfides) <span class="op">-</span> i),</span>
<span id="cb159-51"><a href="#cb159-51" aria-hidden="true" tabindex="-1"></a>                line[<span class="st">'label'</span>], color<span class="op">=</span>line[<span class="st">'color'</span>],</span>
<span id="cb159-52"><a href="#cb159-52" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb159-53"><a href="#cb159-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-54"><a href="#cb159-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Expand Y-limit to fit the tallest label</span></span>
<span id="cb159-55"><a href="#cb159-55" aria-hidden="true" tabindex="-1"></a>    plt.ylim(top<span class="op">=</span>y_max <span class="op">+</span> spacing <span class="op">*</span> (<span class="bu">len</span>(vertical_lines_no_sulfides) <span class="op">+</span> <span class="fl">0.05</span>))</span>
<span id="cb159-56"><a href="#cb159-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-57"><a href="#cb159-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb159-58"><a href="#cb159-58" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss"> - S K-Œ± XANES"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb159-59"><a href="#cb159-59" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Energy (eV)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb159-60"><a href="#cb159-60" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Normalized Absorbance Œº(E)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb159-61"><a href="#cb159-61" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="dv">2475</span>, <span class="dv">2490</span>)  <span class="co"># &lt;-- set energy range here</span></span>
<span id="cb159-62"><a href="#cb159-62" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb159-63"><a href="#cb159-63" aria-hidden="true" tabindex="-1"></a>    plt.yticks([])  <span class="co"># hide y-axis ticks (stacked style)</span></span>
<span id="cb159-64"><a href="#cb159-64" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb159-65"><a href="#cb159-65" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb159-66"><a href="#cb159-66" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb159-67"><a href="#cb159-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.ylim(top=y_max + 0.5) # Expand y-limit to fit top labels if needed</span></span>
<span id="cb159-68"><a href="#cb159-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-69"><a href="#cb159-69" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb159-70"><a href="#cb159-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save XANES plot</span></span>
<span id="cb159-71"><a href="#cb159-71" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="ss">f"</span><span class="sc">{</span>save_folder<span class="sc">}</span><span class="ch">\\</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">_S_XANES_plot.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb159-72"><a href="#cb159-72" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-20-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="trying-lcf" class="level1">
<h1><strong>Trying LCF</strong></h1>
<p>(just have 3 references for now)</p>
<div id="c6e61656" class="cell" data-execution_count="232">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 5Ô∏è‚É£ XANES NORMALIZATION &amp; E0 FINDING ===</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>references_xanes_results <span class="op">=</span> {}</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> reference, df <span class="kw">in</span> averaged_references.items():</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    energy <span class="op">=</span> df[<span class="st">'energy'</span>].values</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> df[<span class="st">'mu_avg'</span>].values</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Larch Group and store data</span></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> Group()</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>    g.energy <span class="op">=</span> energy</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>    g.mu <span class="op">=</span> mu</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply pre-edge normalization (this modifies 'g' in place)</span></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>    pre_edge(g.energy, g.mu, group<span class="op">=</span>g, <span class="co"># energy, intensity, and the group to treat</span></span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>                    pre1 <span class="op">=</span> <span class="op">-</span><span class="dv">50</span>, <span class="co"># the lower bond of the function to fit the pre-edge</span></span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>                    pre2 <span class="op">=</span> <span class="op">-</span><span class="dv">20</span>, <span class="co"># the upper bond of the function to fit the pre-edge</span></span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a>                    norm1 <span class="op">=</span> <span class="dv">40</span>, <span class="co"># the lower bond of the function to fit the post-edge</span></span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>                    norm2<span class="op">=</span> <span class="dv">1020</span>, <span class="co"># the upper bond of the function to fit the post-edge</span></span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a>                    nnorm<span class="op">=</span> <span class="dv">2</span>, <span class="co"># degree for the polynomials</span></span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a>                    nvict<span class="op">=</span> <span class="dv">4</span> <span class="co"># energy exponent to use for pre-edge fit.</span></span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results in DataFrame</span></span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a>    df2_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'energy'</span>: g.energy,</span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mu'</span>: g.mu,</span>
<span id="cb160-26"><a href="#cb160-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pre_edge'</span>: g.pre_edge,</span>
<span id="cb160-27"><a href="#cb160-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'post_edge'</span>: g.post_edge,</span>
<span id="cb160-28"><a href="#cb160-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'norm_mu'</span>: g.norm,</span>
<span id="cb160-29"><a href="#cb160-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'flat'</span>: g.flat,</span>
<span id="cb160-30"><a href="#cb160-30" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb160-31"><a href="#cb160-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-32"><a href="#cb160-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot XANES normalization</span></span>
<span id="cb160-33"><a href="#cb160-33" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb160-34"><a href="#cb160-34" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.pre_edge, label<span class="op">=</span><span class="st">'Pre-Edge'</span>, color<span class="op">=</span><span class="st">'gold'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb160-35"><a href="#cb160-35" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.post_edge, label<span class="op">=</span><span class="st">'Post-Edge'</span>, color<span class="op">=</span><span class="st">'cornflowerblue'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb160-36"><a href="#cb160-36" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.mu, label<span class="op">=</span><span class="st">'Raw mu(E)'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb160-37"><a href="#cb160-37" aria-hidden="true" tabindex="-1"></a>    plt.plot(g.energy, g.norm, label<span class="op">=</span><span class="st">'Normalized'</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb160-38"><a href="#cb160-38" aria-hidden="true" tabindex="-1"></a>    plt.axvline(g.e0, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'E0: </span><span class="sc">{</span>g<span class="sc">.</span>e0<span class="sc">:.1f}</span><span class="ss"> eV'</span>)</span>
<span id="cb160-39"><a href="#cb160-39" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'XANES Normalization - </span><span class="sc">{</span>reference<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb160-40"><a href="#cb160-40" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Energy (eV)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb160-41"><a href="#cb160-41" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'mu(E)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb160-42"><a href="#cb160-42" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb160-43"><a href="#cb160-43" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb160-44"><a href="#cb160-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-45"><a href="#cb160-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb160-46"><a href="#cb160-46" aria-hidden="true" tabindex="-1"></a>    references_xanes_results[reference] <span class="op">=</span> {</span>
<span id="cb160-47"><a href="#cb160-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">'df'</span>: df2_result,</span>
<span id="cb160-48"><a href="#cb160-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'e0'</span>: g.e0</span>
<span id="cb160-49"><a href="#cb160-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb160-50"><a href="#cb160-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb160-51"><a href="#cb160-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Normalized </span><span class="sc">{</span>reference<span class="sc">}</span><span class="ss"> (E0 = </span><span class="sc">{</span>g<span class="sc">.</span>e0<span class="sc">:.1f}</span><span class="ss"> eV)"</span>)</span>
<span id="cb160-52"><a href="#cb160-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-53"><a href="#cb160-53" aria-hidden="true" tabindex="-1"></a><span class="co">#print(references_xanes_results)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_BY_Jarosite_067 (E0 = 2481.9 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-21-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_Pyrite_FeS2_141 (E0 = 2471.4 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-21-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_Schw_1_048 (E0 = 2481.9 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-21-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_Schw_2_049 (E0 = 2481.9 eV)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-21-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Normalized S_Schw_3_050 (E0 = 2481.9 eV)</code></pre>
</div>
</div>
</section>
<section id="functions-added" class="level1">
<h1>Functions added:</h1>
<ul>
<li>LCF fit</li>
<li>Sorting key</li>
</ul>
<div id="71d44b76" class="cell" data-execution_count="233">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lmfit <span class="im">import</span> Model, Parameters</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Linear Combination Fit (LCF) using lmfit</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_lcf_with_lmfit(sample_energy, sample_mu, references):</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Fit a sample spectrum as a linear combination of reference spectra using lmfit.</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="co">    references = dict of {name: (energy_array, mu_array)}</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: fitted model result and weights</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interpolate references to match sample energy grid</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>    ref_interp <span class="op">=</span> {</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>        name: np.interp(sample_energy, energy, mu)</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> name, (energy, mu) <span class="kw">in</span> references.items()</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the model: linear sum of each reference</span></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> model_func(x, <span class="op">**</span>weights):</span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sum</span>(weights[name] <span class="op">*</span> ref_interp[name] <span class="cf">for</span> name <span class="kw">in</span> ref_interp)</span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>    mod <span class="op">=</span> Model(model_func, independent_vars<span class="op">=</span>[<span class="st">'x'</span>])</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initial weights: all equal</span></span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> Parameters()</span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name <span class="kw">in</span> ref_interp:</span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a>        params.add(name, value<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(ref_interp), <span class="bu">min</span><span class="op">=</span><span class="dv">0</span>, <span class="bu">max</span><span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-29"><a href="#cb166-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional: constrain weights to sum to 1</span></span>
<span id="cb166-30"><a href="#cb166-30" aria-hidden="true" tabindex="-1"></a>    params.add(<span class="st">'__constraint__'</span>, expr<span class="op">=</span><span class="st">' + '</span>.join(ref_interp.keys()) <span class="op">+</span> <span class="st">' - 1'</span>)</span>
<span id="cb166-31"><a href="#cb166-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-32"><a href="#cb166-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the model</span></span>
<span id="cb166-33"><a href="#cb166-33" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> mod.fit(sample_mu, params, x<span class="op">=</span>sample_energy)</span>
<span id="cb166-34"><a href="#cb166-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-35"><a href="#cb166-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result, {name: result.params[name].value <span class="cf">for</span> name <span class="kw">in</span> ref_interp}</span>
<span id="cb166-36"><a href="#cb166-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-37"><a href="#cb166-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Sorting Key</span></span>
<span id="cb166-38"><a href="#cb166-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_sort_key(label):</span>
<span id="cb166-39"><a href="#cb166-39" aria-hidden="true" tabindex="-1"></a>    parts <span class="op">=</span> label.split(<span class="st">'-'</span>)  <span class="co"># 'TB-O' ‚Üí ['TB', 'O']</span></span>
<span id="cb166-40"><a href="#cb166-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(parts) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb166-41"><a href="#cb166-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="dv">3</span>, label)  <span class="co"># fallback</span></span>
<span id="cb166-42"><a href="#cb166-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-43"><a href="#cb166-43" aria-hidden="true" tabindex="-1"></a>    _, horizon <span class="op">=</span> parts</span>
<span id="cb166-44"><a href="#cb166-44" aria-hidden="true" tabindex="-1"></a>    horizon_upper <span class="op">=</span> horizon.upper()</span>
<span id="cb166-45"><a href="#cb166-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-46"><a href="#cb166-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(horizon_upper.startswith(x) <span class="cf">for</span> x <span class="kw">in</span> [<span class="st">'CORE'</span>]):</span>
<span id="cb166-47"><a href="#cb166-47" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb166-48"><a href="#cb166-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> horizon_upper <span class="kw">in</span> [<span class="st">'AA'</span>, <span class="st">'AB'</span>, <span class="st">'AC'</span>, <span class="st">'AD'</span>]:</span>
<span id="cb166-49"><a href="#cb166-49" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb166-50"><a href="#cb166-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb166-51"><a href="#cb166-51" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb166-52"><a href="#cb166-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-53"><a href="#cb166-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (category, horizon_upper)</span>
<span id="cb166-54"><a href="#cb166-54" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="applying-lcf-function" class="level2">
<h2 class="anchored" data-anchor-id="applying-lcf-function">Applying LCF function</h2>
<div id="1454a4e1" class="cell" data-execution_count="234">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> larch <span class="im">import</span> Group</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="co">#from larch.xafs import linearcombo_fit</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> interp1d</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ‚úÖ 1. SETUP: Define references and result container</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>reference_keys <span class="op">=</span> [</span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'S_BY_Jarosite_067'</span>,</span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'S_Pyrite_FeS2_141'</span>,</span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#'S_Schw_1_048',</span></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#'S_Schw_2_049',</span></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'S_Schw_3_050'</span></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a>lcf_results <span class="op">=</span> {}</span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-23"><a href="#cb167-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ‚úÖ 2. PREPARE REFERENCE GROUPS</span></span>
<span id="cb167-24"><a href="#cb167-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-25"><a href="#cb167-25" aria-hidden="true" tabindex="-1"></a>reference_groups <span class="op">=</span> {}</span>
<span id="cb167-26"><a href="#cb167-26" aria-hidden="true" tabindex="-1"></a>target_energy <span class="op">=</span> <span class="va">None</span></span>
<span id="cb167-27"><a href="#cb167-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-28"><a href="#cb167-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ref_key <span class="kw">in</span> reference_keys:</span>
<span id="cb167-29"><a href="#cb167-29" aria-hidden="true" tabindex="-1"></a>    ref_df <span class="op">=</span> references_xanes_results[ref_key][<span class="st">'df'</span>]</span>
<span id="cb167-30"><a href="#cb167-30" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> Group()</span>
<span id="cb167-31"><a href="#cb167-31" aria-hidden="true" tabindex="-1"></a>    g.energy <span class="op">=</span> ref_df[<span class="st">'energy'</span>].values</span>
<span id="cb167-32"><a href="#cb167-32" aria-hidden="true" tabindex="-1"></a>    g.mu <span class="op">=</span> ref_df[<span class="st">'norm_mu'</span>].values</span>
<span id="cb167-33"><a href="#cb167-33" aria-hidden="true" tabindex="-1"></a>    reference_groups[ref_key] <span class="op">=</span> g</span>
<span id="cb167-34"><a href="#cb167-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> target_energy <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb167-35"><a href="#cb167-35" aria-hidden="true" tabindex="-1"></a>        target_energy <span class="op">=</span> g.energy</span>
<span id="cb167-36"><a href="#cb167-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-37"><a href="#cb167-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-38"><a href="#cb167-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ‚úÖ 3. RUN LCF ON ALL SAMPLES (EXCLUDING REFERENCES)</span></span>
<span id="cb167-39"><a href="#cb167-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-40"><a href="#cb167-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-41"><a href="#cb167-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare references in the format {name: (energy, norm_mu)}</span></span>
<span id="cb167-42"><a href="#cb167-42" aria-hidden="true" tabindex="-1"></a>ref_spectra <span class="op">=</span> {</span>
<span id="cb167-43"><a href="#cb167-43" aria-hidden="true" tabindex="-1"></a>    key: (</span>
<span id="cb167-44"><a href="#cb167-44" aria-hidden="true" tabindex="-1"></a>        references_xanes_results[key][<span class="st">'df'</span>][<span class="st">'energy'</span>].values,</span>
<span id="cb167-45"><a href="#cb167-45" aria-hidden="true" tabindex="-1"></a>        references_xanes_results[key][<span class="st">'df'</span>][<span class="st">'norm_mu'</span>].values</span>
<span id="cb167-46"><a href="#cb167-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb167-47"><a href="#cb167-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> reference_keys</span>
<span id="cb167-48"><a href="#cb167-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb167-49"><a href="#cb167-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-50"><a href="#cb167-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all samples in xanes_results</span></span>
<span id="cb167-51"><a href="#cb167-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sample_key, result <span class="kw">in</span> xanes_results.items():</span>
<span id="cb167-52"><a href="#cb167-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sample_key <span class="kw">in</span> reference_keys:</span>
<span id="cb167-53"><a href="#cb167-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb167-54"><a href="#cb167-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-55"><a href="#cb167-55" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> result[<span class="st">'df'</span>]</span>
<span id="cb167-56"><a href="#cb167-56" aria-hidden="true" tabindex="-1"></a>    sample_energy <span class="op">=</span> df[<span class="st">'energy'</span>].values</span>
<span id="cb167-57"><a href="#cb167-57" aria-hidden="true" tabindex="-1"></a>    sample_mu <span class="op">=</span> df[<span class="st">'norm_mu'</span>].values</span>
<span id="cb167-58"><a href="#cb167-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-59"><a href="#cb167-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run LCF and store result</span></span>
<span id="cb167-60"><a href="#cb167-60" aria-hidden="true" tabindex="-1"></a>    lcf_fit, weights <span class="op">=</span> run_lcf_with_lmfit(sample_energy, sample_mu, ref_spectra)</span>
<span id="cb167-61"><a href="#cb167-61" aria-hidden="true" tabindex="-1"></a>    lcf_results[sample_key] <span class="op">=</span> weights</span>
<span id="cb167-62"><a href="#cb167-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-63"><a href="#cb167-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-64"><a href="#cb167-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-65"><a href="#cb167-65" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-66"><a href="#cb167-66" aria-hidden="true" tabindex="-1"></a><span class="co"># ‚úÖ 4. ORGANIZE RESULTS BY MINE-HORIZON</span></span>
<span id="cb167-67"><a href="#cb167-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-68"><a href="#cb167-68" aria-hidden="true" tabindex="-1"></a>mine_site_data <span class="op">=</span> {}</span>
<span id="cb167-69"><a href="#cb167-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-70"><a href="#cb167-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, weights <span class="kw">in</span> lcf_results.items():</span>
<span id="cb167-71"><a href="#cb167-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb167-72"><a href="#cb167-72" aria-hidden="true" tabindex="-1"></a>        parts <span class="op">=</span> key.split(<span class="st">'_'</span>)  <span class="co"># e.g., ['S', 'TB', 'O', '001', 'clean']</span></span>
<span id="cb167-73"><a href="#cb167-73" aria-hidden="true" tabindex="-1"></a>        mine <span class="op">=</span> parts[<span class="dv">1</span>]</span>
<span id="cb167-74"><a href="#cb167-74" aria-hidden="true" tabindex="-1"></a>        horizon <span class="op">=</span> parts[<span class="dv">2</span>]</span>
<span id="cb167-75"><a href="#cb167-75" aria-hidden="true" tabindex="-1"></a>        combined_key <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>mine<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>horizon<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb167-76"><a href="#cb167-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mine <span class="kw">not</span> <span class="kw">in</span> mine_site_data:</span>
<span id="cb167-77"><a href="#cb167-77" aria-hidden="true" tabindex="-1"></a>            mine_site_data[mine] <span class="op">=</span> {}</span>
<span id="cb167-78"><a href="#cb167-78" aria-hidden="true" tabindex="-1"></a>        mine_site_data[mine][combined_key] <span class="op">=</span> weights</span>
<span id="cb167-79"><a href="#cb167-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb167-80"><a href="#cb167-80" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚ö†Ô∏è Skipped </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss"> due to error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb167-81"><a href="#cb167-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-82"><a href="#cb167-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-83"><a href="#cb167-83" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-84"><a href="#cb167-84" aria-hidden="true" tabindex="-1"></a><span class="co"># ‚úÖ 5. PLOT STACKED BAR CHART PER MINE SITE</span></span>
<span id="cb167-85"><a href="#cb167-85" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb167-86"><a href="#cb167-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-87"><a href="#cb167-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mine, horizons <span class="kw">in</span> mine_site_data.items():</span>
<span id="cb167-88"><a href="#cb167-88" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(horizons).T</span>
<span id="cb167-89"><a href="#cb167-89" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.fillna(<span class="dv">0</span>)</span>
<span id="cb167-90"><a href="#cb167-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-91"><a href="#cb167-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort and flip so the deepest horizons appear at the bottom</span></span>
<span id="cb167-92"><a href="#cb167-92" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.loc[<span class="bu">sorted</span>(df.index, key<span class="op">=</span>custom_sort_key)].iloc[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb167-93"><a href="#cb167-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-94"><a href="#cb167-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-95"><a href="#cb167-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Friendly reference names and color assignment</span></span>
<span id="cb167-96"><a href="#cb167-96" aria-hidden="true" tabindex="-1"></a>    friendly_names <span class="op">=</span> {</span>
<span id="cb167-97"><a href="#cb167-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">'S_BY_Jarosite_067'</span>: <span class="st">'Jarosite'</span>,</span>
<span id="cb167-98"><a href="#cb167-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">'S_Pyrite_FeS2_141'</span>: <span class="st">'Pyrite'</span>,</span>
<span id="cb167-99"><a href="#cb167-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'S_Schw_1_048'</span>: <span class="st">'Schwertmannite'</span>,</span>
<span id="cb167-100"><a href="#cb167-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">'S_Schw_2_049'</span>: <span class="st">'Schwertmannite'</span>,</span>
<span id="cb167-101"><a href="#cb167-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">'S_Schw_3_050'</span>: <span class="st">'Schwertmannite'</span>,</span>
<span id="cb167-102"><a href="#cb167-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb167-103"><a href="#cb167-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename columns to friendly names</span></span>
<span id="cb167-104"><a href="#cb167-104" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>friendly_names)</span>
<span id="cb167-105"><a href="#cb167-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb167-106"><a href="#cb167-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb167-107"><a href="#cb167-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder columns: sulfides to the left, sulfates to the right</span></span>
<span id="cb167-108"><a href="#cb167-108" aria-hidden="true" tabindex="-1"></a>    desired_order <span class="op">=</span> [<span class="st">'Sphalerite'</span>, <span class="st">'Pyrite'</span>, <span class="st">'Chalcopyrite'</span>,  <span class="co"># Sulfides</span></span>
<span id="cb167-109"><a href="#cb167-109" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Schwertmannite'</span>,             <span class="co"># Intermediate species</span></span>
<span id="cb167-110"><a href="#cb167-110" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Jarosite'</span>, <span class="st">'Natrojarosite'</span>, <span class="st">'Gypsum'</span>]    <span class="co"># Sulfates</span></span>
<span id="cb167-111"><a href="#cb167-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-112"><a href="#cb167-112" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[col <span class="cf">for</span> col <span class="kw">in</span> desired_order <span class="cf">if</span> col <span class="kw">in</span> df.columns]]</span>
<span id="cb167-113"><a href="#cb167-113" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb167-114"><a href="#cb167-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-115"><a href="#cb167-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define color map</span></span>
<span id="cb167-116"><a href="#cb167-116" aria-hidden="true" tabindex="-1"></a>    color_map <span class="op">=</span> {</span>
<span id="cb167-117"><a href="#cb167-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Jarosite"</span>: <span class="st">"orange"</span>,</span>
<span id="cb167-118"><a href="#cb167-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pyrite"</span>: <span class="st">"#CAB2D6"</span>,</span>
<span id="cb167-119"><a href="#cb167-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Schwertmannite"</span>: <span class="st">"gold"</span>,</span>
<span id="cb167-120"><a href="#cb167-120" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add other references if needed</span></span>
<span id="cb167-121"><a href="#cb167-121" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb167-122"><a href="#cb167-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-123"><a href="#cb167-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign consistent colors</span></span>
<span id="cb167-124"><a href="#cb167-124" aria-hidden="true" tabindex="-1"></a>    bar_colors <span class="op">=</span> [color_map.get(col, <span class="st">"grey"</span>) <span class="cf">for</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb167-125"><a href="#cb167-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-126"><a href="#cb167-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot</span></span>
<span id="cb167-127"><a href="#cb167-127" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> df.plot(kind<span class="op">=</span><span class="st">'barh'</span>, stacked<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">8</span>), color<span class="op">=</span>bar_colors)</span>
<span id="cb167-128"><a href="#cb167-128" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"LCF ‚Äì </span><span class="sc">{</span>mine<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb167-129"><a href="#cb167-129" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Fraction"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb167-130"><a href="#cb167-130" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Tailings Horizon"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb167-131"><a href="#cb167-131" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb167-132"><a href="#cb167-132" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(FuncFormatter(<span class="kw">lambda</span> x, _: <span class="ss">f"</span><span class="sc">{</span>x<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">%"</span>))  <span class="co"># show 0‚Äì100%</span></span>
<span id="cb167-133"><a href="#cb167-133" aria-hidden="true" tabindex="-1"></a>    ax.legend(title<span class="op">=</span><span class="st">"Reference"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb167-134"><a href="#cb167-134" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'x'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb167-135"><a href="#cb167-135" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb167-136"><a href="#cb167-136" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb167-137"><a href="#cb167-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-138"><a href="#cb167-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-139"><a href="#cb167-139" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-23-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lcf-xanes-fitting-check" class="level2">
<h2 class="anchored" data-anchor-id="lcf-xanes-fitting-check"><strong>LCF XANES Fitting check</strong></h2>
<div id="b8da3613" class="cell" data-execution_count="235">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> interp1d</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_lcf_stacked_xanes(xanes_results, references_xanes_results, lcf_results, mine_site_data, custom_sort_key):</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mine, horizons <span class="kw">in</span> mine_site_data.items():</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get matching sample keys</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>        sample_keys <span class="op">=</span> [k <span class="cf">for</span> k <span class="kw">in</span> lcf_results <span class="cf">if</span> <span class="ss">f"_</span><span class="sc">{</span>mine<span class="sc">}</span><span class="ss">_"</span> <span class="kw">in</span> k]</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sample_keys:</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"‚ö†Ô∏è No samples found for mine: </span><span class="sc">{</span>mine<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract 'Mine-Horizon' like TB-O</span></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> extract_horizon(sample_key):</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>                parts <span class="op">=</span> sample_key.split(<span class="st">'_'</span>)</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>parts[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>parts[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> sample_key</span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sort and reverse for top-down order</span></span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>        sorted_keys <span class="op">=</span> <span class="bu">sorted</span>(sample_keys, key<span class="op">=</span><span class="kw">lambda</span> k: custom_sort_key(extract_horizon(k)))</span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-25"><a href="#cb168-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Auto-scale figure height</span></span>
<span id="cb168-26"><a href="#cb168-26" aria-hidden="true" tabindex="-1"></a>        fig_height <span class="op">=</span> <span class="bu">max</span>(<span class="dv">6</span>, <span class="bu">len</span>(sorted_keys) <span class="op">*</span> <span class="fl">1.01</span>)</span>
<span id="cb168-27"><a href="#cb168-27" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, fig_height))</span>
<span id="cb168-28"><a href="#cb168-28" aria-hidden="true" tabindex="-1"></a>        offset_step <span class="op">=</span> <span class="fl">1.2</span></span>
<span id="cb168-29"><a href="#cb168-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-30"><a href="#cb168-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, sample_key <span class="kw">in</span> <span class="bu">enumerate</span>(sorted_keys):</span>
<span id="cb168-31"><a href="#cb168-31" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> xanes_results[sample_key][<span class="st">'df'</span>]</span>
<span id="cb168-32"><a href="#cb168-32" aria-hidden="true" tabindex="-1"></a>            energy <span class="op">=</span> df[<span class="st">'energy'</span>].values</span>
<span id="cb168-33"><a href="#cb168-33" aria-hidden="true" tabindex="-1"></a>            norm_mu <span class="op">=</span> df[<span class="st">'norm_mu'</span>].values</span>
<span id="cb168-34"><a href="#cb168-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-35"><a href="#cb168-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Build LCF fit</span></span>
<span id="cb168-36"><a href="#cb168-36" aria-hidden="true" tabindex="-1"></a>            fit_weights <span class="op">=</span> lcf_results[sample_key]</span>
<span id="cb168-37"><a href="#cb168-37" aria-hidden="true" tabindex="-1"></a>            fit_curve <span class="op">=</span> np.zeros_like(energy)</span>
<span id="cb168-38"><a href="#cb168-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-39"><a href="#cb168-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ref_key, weight <span class="kw">in</span> fit_weights.items():</span>
<span id="cb168-40"><a href="#cb168-40" aria-hidden="true" tabindex="-1"></a>                ref_df <span class="op">=</span> references_xanes_results[ref_key][<span class="st">'df'</span>]</span>
<span id="cb168-41"><a href="#cb168-41" aria-hidden="true" tabindex="-1"></a>                ref_energy <span class="op">=</span> ref_df[<span class="st">'energy'</span>].values</span>
<span id="cb168-42"><a href="#cb168-42" aria-hidden="true" tabindex="-1"></a>                ref_mu <span class="op">=</span> ref_df[<span class="st">'norm_mu'</span>].values</span>
<span id="cb168-43"><a href="#cb168-43" aria-hidden="true" tabindex="-1"></a>                ref_interp <span class="op">=</span> np.interp(energy, ref_energy, ref_mu)</span>
<span id="cb168-44"><a href="#cb168-44" aria-hidden="true" tabindex="-1"></a>                fit_curve <span class="op">+=</span> weight <span class="op">*</span> ref_interp</span>
<span id="cb168-45"><a href="#cb168-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-46"><a href="#cb168-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Compute RMSE and R¬≤</span></span>
<span id="cb168-47"><a href="#cb168-47" aria-hidden="true" tabindex="-1"></a>            rmse <span class="op">=</span> np.sqrt(mean_squared_error(norm_mu, fit_curve))</span>
<span id="cb168-48"><a href="#cb168-48" aria-hidden="true" tabindex="-1"></a>            r2 <span class="op">=</span> r2_score(norm_mu, fit_curve)</span>
<span id="cb168-49"><a href="#cb168-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-50"><a href="#cb168-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plot curves with vertical offset</span></span>
<span id="cb168-51"><a href="#cb168-51" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">=</span> i <span class="op">*</span> offset_step</span>
<span id="cb168-52"><a href="#cb168-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb168-53"><a href="#cb168-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb168-54"><a href="#cb168-54" aria-hidden="true" tabindex="-1"></a>            plt.plot(energy, norm_mu <span class="op">-</span> offset, color<span class="op">=</span><span class="st">'black'</span>, lw<span class="op">=</span><span class="fl">1.4</span>, label<span class="op">=</span><span class="st">'Data'</span> <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span>)</span>
<span id="cb168-55"><a href="#cb168-55" aria-hidden="true" tabindex="-1"></a>            plt.plot(energy, fit_curve <span class="op">-</span> offset, color<span class="op">=</span><span class="st">'red'</span>, lw<span class="op">=</span><span class="fl">1.2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'LCF Fit'</span> <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span>)</span>
<span id="cb168-56"><a href="#cb168-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-57"><a href="#cb168-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Label horizon and stats</span></span>
<span id="cb168-58"><a href="#cb168-58" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> extract_horizon(sample_key)</span>
<span id="cb168-59"><a href="#cb168-59" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plot bold label</span></span>
<span id="cb168-60"><a href="#cb168-60" aria-hidden="true" tabindex="-1"></a>            plt.text(energy[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">19</span>, <span class="op">-</span>offset <span class="op">+</span> <span class="fl">0.25</span>, label, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb168-61"><a href="#cb168-61" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plot smaller stats below</span></span>
<span id="cb168-62"><a href="#cb168-62" aria-hidden="true" tabindex="-1"></a>            plt.text(energy[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">19</span>, <span class="op">-</span>offset <span class="op">-</span> <span class="fl">0.25</span>, <span class="ss">f"RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ch">\n</span><span class="ss">R¬≤=</span><span class="sc">{</span>r2<span class="sc">:.2f}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">8</span>, fontweight<span class="op">=</span><span class="st">'normal'</span>)</span>
<span id="cb168-63"><a href="#cb168-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-64"><a href="#cb168-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-65"><a href="#cb168-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Final plot styling</span></span>
<span id="cb168-66"><a href="#cb168-66" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f"</span><span class="sc">{</span>mine<span class="sc">}</span><span class="ss"> ‚Äì XANES LCF"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb168-67"><a href="#cb168-67" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">"Energy (eV)"</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb168-68"><a href="#cb168-68" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">"Normalized Œº(E) (offset)"</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb168-69"><a href="#cb168-69" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb168-70"><a href="#cb168-70" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb168-71"><a href="#cb168-71" aria-hidden="true" tabindex="-1"></a>        plt.xlim(<span class="dv">2465</span>, <span class="dv">2490</span>)</span>
<span id="cb168-72"><a href="#cb168-72" aria-hidden="true" tabindex="-1"></a>        plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb168-73"><a href="#cb168-73" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb168-74"><a href="#cb168-74" aria-hidden="true" tabindex="-1"></a>        plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calling-up-the-function-for-fit-check" class="level2">
<h2 class="anchored" data-anchor-id="calling-up-the-function-for-fit-check">Calling up the function for fit check</h2>
<div id="183ebca4" class="cell" data-execution_count="236">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>plot_lcf_stacked_xanes(</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>    xanes_results,</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>    references_xanes_results,</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    lcf_results,</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>    mine_site_data,</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>    custom_sort_key</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-25-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ignore-from-here-onwards" class="level1">
<h1><strong>IGNORE FROM HERE ONWARDS!</strong></h1>
</section>
<section id="plotting-exafs-chik" class="level1">
<h1><strong>Plotting EXAFS chi(K)</strong></h1>
<div id="bda0e489" class="cell" data-execution_count="237">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2Ô∏è‚É£ Plotting Function: EXAFS chi(k)</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>offset_step <span class="op">=</span> <span class="dv">1</span>  <span class="co"># adjust if needed for better separation</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mine_abbrev, color <span class="kw">in</span> mine_abbrev_color_mapping.items():</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> sample_names <span class="cf">if</span> extract_abbreviation(s) <span class="op">==</span> mine_abbrev]</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> <span class="bu">sorted</span>(mine_samples, key<span class="op">=</span>custom_sort_key)</span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> mine_samples:</span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚ö†Ô∏è No samples found for </span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, sample <span class="kw">in</span> <span class="bu">enumerate</span>(mine_samples):</span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> exafs_results[sample][<span class="st">'k'</span>]</span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a>        chi_k <span class="op">=</span> exafs_results[sample][<span class="st">'chi_k'</span>]</span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">=</span> idx <span class="op">*</span> offset_step</span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-22"><a href="#cb170-22" aria-hidden="true" tabindex="-1"></a>        plt.plot(k, chi_k <span class="op">-</span> offset, label<span class="op">=</span>sample, color<span class="op">=</span>color, lw<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb170-23"><a href="#cb170-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-24"><a href="#cb170-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add label next to each curve</span></span>
<span id="cb170-25"><a href="#cb170-25" aria-hidden="true" tabindex="-1"></a>        plt.text(k.<span class="bu">min</span>() <span class="op">+</span> <span class="dv">4</span>, <span class="op">-</span>offset <span class="op">+</span> <span class="fl">0.05</span>, sample, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb170-26"><a href="#cb170-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-27"><a href="#cb170-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb170-28"><a href="#cb170-28" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss"> - S K-edge EXAFS chi(k)"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb170-29"><a href="#cb170-29" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"k (√Ö‚Åª¬π)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb170-30"><a href="#cb170-30" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"œá(k)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb170-31"><a href="#cb170-31" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb170-32"><a href="#cb170-32" aria-hidden="true" tabindex="-1"></a>    plt.yticks([])  <span class="co"># hide y-axis ticks (stacked style)</span></span>
<span id="cb170-33"><a href="#cb170-33" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb170-34"><a href="#cb170-34" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb170-35"><a href="#cb170-35" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb170-36"><a href="#cb170-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-37"><a href="#cb170-37" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb170-38"><a href="#cb170-38" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="ss">f"</span><span class="sc">{</span>save_folder<span class="sc">}</span><span class="ch">\\</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">_S_EXAFS_chik_plot.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb170-39"><a href="#cb170-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ö†Ô∏è No samples found for BB
‚ö†Ô∏è No samples found for FM
‚ö†Ô∏è No samples found for IK
‚ö†Ô∏è No samples found for IM</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-26-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-exafs-ft" class="level1">
<h1><strong>Plotting EXAFS FT</strong></h1>
<div id="e22f5741" class="cell" data-execution_count="238">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 3Ô∏è‚É£ Plotting Function: EXAFS FT</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================================</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>offset_step <span class="op">=</span> <span class="fl">0.3</span>  <span class="co"># adjust if needed</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mine_abbrev, color <span class="kw">in</span> mine_abbrev_color_mapping.items():</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> sample_names <span class="cf">if</span> extract_abbreviation(s) <span class="op">==</span> mine_abbrev]</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>    mine_samples <span class="op">=</span> <span class="bu">sorted</span>(mine_samples, key<span class="op">=</span>custom_sort_key)</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> mine_samples:</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚ö†Ô∏è No samples found for </span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, sample <span class="kw">in</span> <span class="bu">enumerate</span>(mine_samples):</span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> exafs_results[sample][<span class="st">'r'</span>]</span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>        chi_r <span class="op">=</span> np.<span class="bu">abs</span>(exafs_results[sample][<span class="st">'chi_r'</span>])</span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">=</span> idx <span class="op">*</span> offset_step</span>
<span id="cb172-21"><a href="#cb172-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-22"><a href="#cb172-22" aria-hidden="true" tabindex="-1"></a>        plt.plot(r, chi_r <span class="op">-</span> offset, label<span class="op">=</span>sample, color<span class="op">=</span>color, lw<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb172-23"><a href="#cb172-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-24"><a href="#cb172-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add label next to each curve</span></span>
<span id="cb172-25"><a href="#cb172-25" aria-hidden="true" tabindex="-1"></a>        plt.text(r.<span class="bu">min</span>() <span class="op">+</span> <span class="dv">7</span>, <span class="op">-</span>offset <span class="op">+</span> <span class="fl">0.05</span>, sample, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb172-26"><a href="#cb172-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-27"><a href="#cb172-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-28"><a href="#cb172-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb172-29"><a href="#cb172-29" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss"> - S K-edge EXAFS FT"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb172-30"><a href="#cb172-30" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="vs">r"$R + \Delta R$ (√Ö)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb172-31"><a href="#cb172-31" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Fourier Transform magnitude"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb172-32"><a href="#cb172-32" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb172-33"><a href="#cb172-33" aria-hidden="true" tabindex="-1"></a>    plt.yticks([])  <span class="co"># hide y-axis ticks</span></span>
<span id="cb172-34"><a href="#cb172-34" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb172-35"><a href="#cb172-35" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb172-36"><a href="#cb172-36" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb172-37"><a href="#cb172-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-38"><a href="#cb172-38" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb172-39"><a href="#cb172-39" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="ss">f"</span><span class="sc">{</span>save_folder<span class="sc">}</span><span class="ch">\\</span><span class="sc">{</span>mine_abbrev<span class="sc">}</span><span class="ss">_S_EXAFS_chiR_plot.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb172-40"><a href="#cb172-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚ö†Ô∏è No samples found for BB
‚ö†Ô∏è No samples found for FM
‚ö†Ô∏è No samples found for IK
‚ö†Ô∏è No samples found for IM</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2207_Sulfur_XANES_analysis_files/figure-html/cell-27-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>